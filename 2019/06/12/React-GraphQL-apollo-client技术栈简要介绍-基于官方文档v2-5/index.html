<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Neucha:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="react,typescript,apollo-client,Apollo," />





  <link rel="alternate" href="/atom.xml" title="XieYang-blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="æœ¬æ–‡æ¡£è¯¸å¤šä¾‹å­æ¥æºäºå®˜æ–¹æ–‡æ¡£ï¼Œä½†ä¹Ÿåœ¨ç¼–å†™è¿‡ç¨‹ä¸­æ·»åŠ äº†æˆ‘å¯¹è¿™å¥—æŠ€æœ¯æ ˆçš„ä¸€äº›ç†è§£ï¼Œå¦‚æœä½ æ›´å–œæ¬¢çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¯·ç§»æ­¥å®˜ç½‘/å®˜æ–¹æ–‡æ¡£  ä¸ºä»€ä¹ˆè¦ä½¿ç”¨apolloï¼Ÿæ²¡æœ‰reduxç¹ççš„actionã€reducerã€dispatchâ€¦â€¦è®©å…¨å±€ç®¡ç†storeå˜å¾—ç®€å•ã€ç›´ç™½ï¼ ä½¿ç”¨reduxç®¡ç†çŠ¶æ€ï¼Œé‡å¿ƒæ˜¯æ”¾åœ¨å¦‚ä½•å»æ‹¿æ•°æ®ä¸Šï¼›è€ŒapolloæŠŠé‡å¿ƒæ”¾åœ¨éœ€è¦ä»€ä¹ˆæ•°æ®ä¸Šã€‚ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼  å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç«‹å³">
<meta name="keywords" content="react,typescript,apollo-client,Apollo">
<meta property="og:type" content="article">
<meta property="og:title" content="React + GraphQL + apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»(åŸºäºå®˜æ–¹æ–‡æ¡£v2.5)">
<meta property="og:url" content="http://blog.xieyangogo.cn/2019/06/12/React-GraphQL-apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»-åŸºäºå®˜æ–¹æ–‡æ¡£v2-5/index.html">
<meta property="og:site_name" content="XieYang-blog">
<meta property="og:description" content="æœ¬æ–‡æ¡£è¯¸å¤šä¾‹å­æ¥æºäºå®˜æ–¹æ–‡æ¡£ï¼Œä½†ä¹Ÿåœ¨ç¼–å†™è¿‡ç¨‹ä¸­æ·»åŠ äº†æˆ‘å¯¹è¿™å¥—æŠ€æœ¯æ ˆçš„ä¸€äº›ç†è§£ï¼Œå¦‚æœä½ æ›´å–œæ¬¢çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¯·ç§»æ­¥å®˜ç½‘/å®˜æ–¹æ–‡æ¡£  ä¸ºä»€ä¹ˆè¦ä½¿ç”¨apolloï¼Ÿæ²¡æœ‰reduxç¹ççš„actionã€reducerã€dispatchâ€¦â€¦è®©å…¨å±€ç®¡ç†storeå˜å¾—ç®€å•ã€ç›´ç™½ï¼ ä½¿ç”¨reduxç®¡ç†çŠ¶æ€ï¼Œé‡å¿ƒæ˜¯æ”¾åœ¨å¦‚ä½•å»æ‹¿æ•°æ®ä¸Šï¼›è€ŒapolloæŠŠé‡å¿ƒæ”¾åœ¨éœ€è¦ä»€ä¹ˆæ•°æ®ä¸Šã€‚ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼  å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç«‹å³">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.xieyangogo.cn/images/React-GraphQL-apollo-client/ROOT_QUERY.png">
<meta property="og:image" content="http://blog.xieyangogo.cn/images/React-GraphQL-apollo-client/id&typename.png">
<meta property="og:image" content="http://blog.xieyangogo.cn/images/React-GraphQL-apollo-client/__typename.png">
<meta property="og:updated_time" content="2019-06-13T06:08:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React + GraphQL + apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»(åŸºäºå®˜æ–¹æ–‡æ¡£v2.5)">
<meta name="twitter:description" content="æœ¬æ–‡æ¡£è¯¸å¤šä¾‹å­æ¥æºäºå®˜æ–¹æ–‡æ¡£ï¼Œä½†ä¹Ÿåœ¨ç¼–å†™è¿‡ç¨‹ä¸­æ·»åŠ äº†æˆ‘å¯¹è¿™å¥—æŠ€æœ¯æ ˆçš„ä¸€äº›ç†è§£ï¼Œå¦‚æœä½ æ›´å–œæ¬¢çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¯·ç§»æ­¥å®˜ç½‘/å®˜æ–¹æ–‡æ¡£  ä¸ºä»€ä¹ˆè¦ä½¿ç”¨apolloï¼Ÿæ²¡æœ‰reduxç¹ççš„actionã€reducerã€dispatchâ€¦â€¦è®©å…¨å±€ç®¡ç†storeå˜å¾—ç®€å•ã€ç›´ç™½ï¼ ä½¿ç”¨reduxç®¡ç†çŠ¶æ€ï¼Œé‡å¿ƒæ˜¯æ”¾åœ¨å¦‚ä½•å»æ‹¿æ•°æ®ä¸Šï¼›è€ŒapolloæŠŠé‡å¿ƒæ”¾åœ¨éœ€è¦ä»€ä¹ˆæ•°æ®ä¸Šã€‚ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼  å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç«‹å³">
<meta name="twitter:image" content="http://blog.xieyangogo.cn/images/React-GraphQL-apollo-client/ROOT_QUERY.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: 'CBD64E6R0S',
      apiKey: '2a6f0239ea18967e10d740ceaa4ccbfa',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"æœç´¢å¸–å­","hits_empty":"æœªæœç´¢åˆ°å…³äº ${query} çš„æ–‡ç« ","hits_stats":"åœ¨ ${time} ms å†…æœç´¢åˆ° ${hits} æ¡ç»“æœ"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.xieyangogo.cn/2019/06/12/React-GraphQL-apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»-åŸºäºå®˜æ–¹æ–‡æ¡£v2-5/"/>





  <title> React + GraphQL + apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»(åŸºäºå®˜æ–¹æ–‡æ¡£v2.5) | XieYang-blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?bcbac8734f5250621c379fd62b357c26";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">XieYang-blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <h1 class="site-subtitle" itemprop="description"></h1>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.xieyangogo.cn" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-list">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-list"></i> <br />
            
            æ–‡ç« åˆ—è¡¨
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.xieyangogo.cn/2019/06/12/React-GraphQL-apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»-åŸºäºå®˜æ–¹æ–‡æ¡£v2-5/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Oceanxy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="XieYang-blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="XieYang-blog" src="/images/avatar.jpg">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                React + GraphQL + apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»(åŸºäºå®˜æ–¹æ–‡æ¡£v2.5)
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-12T16:47:17+08:00">
                2019-06-12 16:47:17
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">æ›´æ–°äº</span>
              
              <time title="æ›´æ–°äº" itemprop="dateModified" datetime="2019-06-13T14:08:02+08:00">
                2019-06-13 14:08:02
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2019/06/12/React-GraphQL-apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»-åŸºäºå®˜æ–¹æ–‡æ¡£v2-5/" class="leancloud_visitors" data-flag-title="React + GraphQL + apollo-clientæŠ€æœ¯æ ˆç®€è¦ä»‹ç»(åŸºäºå®˜æ–¹æ–‡æ¡£v2.5)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          




        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>æœ¬æ–‡æ¡£è¯¸å¤šä¾‹å­æ¥æºäºå®˜æ–¹æ–‡æ¡£ï¼Œä½†ä¹Ÿåœ¨ç¼–å†™è¿‡ç¨‹ä¸­æ·»åŠ äº†æˆ‘å¯¹è¿™å¥—æŠ€æœ¯æ ˆçš„ä¸€äº›ç†è§£ï¼Œå¦‚æœä½ æ›´å–œæ¬¢çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¯·ç§»æ­¥<a href="https://www.apollographql.com/" target="_blank" rel="noopener">å®˜ç½‘</a>/<a href="https://www.apollographql.com/docs/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨apolloï¼Ÿ<br>æ²¡æœ‰reduxç¹ççš„actionã€reducerã€dispatchâ€¦â€¦è®©å…¨å±€ç®¡ç†storeå˜å¾—ç®€å•ã€ç›´ç™½ï¼</p>
<p><strong>ä½¿ç”¨<code>redux</code>ç®¡ç†çŠ¶æ€ï¼Œé‡å¿ƒæ˜¯æ”¾åœ¨å¦‚ä½•å»æ‹¿æ•°æ®ä¸Šï¼›è€Œ<code>apollo</code>æŠŠé‡å¿ƒæ”¾åœ¨éœ€è¦ä»€ä¹ˆæ•°æ®ä¸Šã€‚ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼</strong></p>
</blockquote>
<p>å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç«‹å³å¼€å§‹ï¼</p>
<a id="more"></a>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="åˆ›å»ºReacté¡¹ç›®"><a href="#åˆ›å»ºReacté¡¹ç›®" class="headerlink" title="åˆ›å»ºReacté¡¹ç›®"></a>åˆ›å»ºReacté¡¹ç›®</h3><ol>
<li>ä½ å¯ä»¥ä½¿ç”¨<code>create-react-app</code>å¿«é€Ÿåˆ›å»ºä¸€ä¸ªReactåº”ç”¨ï¼Œä¸ç†Ÿæ‚‰<a href="https://facebook.github.io/create-react-app/" target="_blank" rel="noopener">create-react-app</a>çš„å°ä¼™ä¼´å¯ä»¥å…ˆè¡Œäº†è§£ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm i create-react-app -g</span><br><span class="line"></span><br><span class="line">create-react-app react-apollo-client-demo --typescript</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> react-apollo-client-demo</span><br><span class="line"></span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ä¹Ÿå¯ä»¥åœ¨<a href="https://codesandbox.io/" target="_blank" rel="noopener">codesandbox</a>ä¸Šåœ¨çº¿æ­å»ºReacté¡¹ç›®ã€‚æ–¹ä¾¿å¿«æ·ï¼</li>
</ol>
<h3 id="æ­å»ºGraphQLæœåŠ¡"><a href="#æ­å»ºGraphQLæœåŠ¡" class="headerlink" title="æ­å»ºGraphQLæœåŠ¡"></a>æ­å»ºGraphQLæœåŠ¡</h3><ol>
<li>ä½ å¯ä»¥åœ¨githubä¸Šfork <a href="https://github.com/glennreyes/graphpack" target="_blank" rel="noopener">graphpack</a>é¡¹ç›®ï¼Œç„¶åä½¿ç”¨<code>githubè´¦å·</code>ç™»å½•<code>codesandbox</code>å¹¶å¯¼å…¥è¯¥é¡¹ç›®ï¼Œå³å¯é›¶é…ç½®æ­å»ºä¸€ä¸ªåœ¨çº¿çš„GraphQLæœåŠ¡ã€‚<br> æœ¬æ–‡æ¡£åœ¨ç¼–å†™æ—¶åœ¨<code>codesandbox</code>ä¸Šæ­å»ºäº†ä¸€ä¸ªæœåŠ¡ï¼Œå¯ä¾›å‚è€ƒï¼š<a href="https://kdvmr.sse.codesandbox.io/" target="_blank" rel="noopener">https://kdvmr.sse.codesandbox.io/</a></li>
<li>ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ­å»ºè‡ªå·±çš„GraphQLæœåŠ¡ï¼Œå› ä¸åœ¨æœ¬æ–‡æ¡£è®¨è®ºèŒƒå›´ï¼Œæ‰€ä»¥æš‚ä¸æä¾›æ­å»ºæ­¥éª¤ã€‚</li>
</ol>
<h3 id="å®‰è£…éœ€è¦çš„åŒ…"><a href="#å®‰è£…éœ€è¦çš„åŒ…" class="headerlink" title="å®‰è£…éœ€è¦çš„åŒ…"></a>å®‰è£…éœ€è¦çš„åŒ…</h3><p>æ—¢ç„¶æœ¬æ–‡è®²çš„æ˜¯<code>graphql</code> + <code>react</code> + <code>apollo</code>å¼€å‘React Appï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä»¥ä¸‹åŒ…æ¥æ”¯æ’‘ï¼Œä»¥å‰ä½¿ç”¨çš„reduxã€react-reduxç­‰åŒ…å¯ä»¥ä¸¢åˆ°ä¸€è¾¹äº†ã€‚</p>
<blockquote>
<p>PSï¼šåœ¨apollo 1.0æ—¶ä»£ï¼Œ<code>æœ¬åœ°çŠ¶æ€ç®¡ç†</code>åŠŸèƒ½ï¼ˆæœ¬æ–‡æ¡£åé¢ä½œäº†ä»‹ç»ï¼‰è¿˜ä¾èµ–äºreduxç­‰ç›¸å…³æŠ€æœ¯ã€‚ä½†ç°åœ¨apolloå·²ç»å‡çº§åˆ°2.0æ—¶ä»£ï¼Œå·²ç»å®Œå…¨æŠ›å¼ƒäº†reduxçš„ä¾èµ–ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install apollo-boost react-apollo graphql --save</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰ä¸ªåŒ…çš„ä½œç”¨ï¼š</p>
<ul>
<li><a href="https://www.apollographql.com/docs/react/essentials/get-started/#whats-included" target="_blank" rel="noopener">apollo-boost</a>ï¼šåŒ…å«è®¾ç½®Apollo Clientæ‰€éœ€çš„æ ¸å¿ƒåŒ…ã€‚å¦‚æœä½ éœ€è¦æŒ‰è‡ªå·±çš„æ„æ„¿å®šåˆ¶åŒ–é¡¹ç›®ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©å®‰è£…å•ç‹¬çš„åŒ…ï¼š<br>  â€” <code>apollo-client</code>ï¼šapolloå®¢æˆ·ç«¯åŒ…<ul>
<li><code>apollo-cache-inmemory</code>ï¼šå®˜æ–¹æ¨èçš„ç¼“å­˜åŒ…</li>
<li><code>apollo-link-http</code>ï¼šç”¨äºè·å–è¿œç¨‹æ•°æ®çš„åŒ…</li>
<li><code>apollo-link-error</code>ï¼šç”¨äºå¤„ç†é”™è¯¯çš„åŒ…</li>
<li><code>apollo-link-state</code>ï¼šæœ¬åœ°çŠ¶æ€ç®¡ç†çš„åŒ…ï¼ˆ2.5ç‰ˆæœ¬å·²é›†æˆåˆ°<code>apollo-client</code>ï¼‰</li>
</ul>
</li>
<li><a href="https://www.apollographql.com/docs/react/api/react-apollo/" target="_blank" rel="noopener">react-apollo</a>ï¼šreactçš„å›¾å±‚é›†æˆï¼ˆç”¨reactçš„ç»„ä»¶æ–¹å¼æ¥ä½¿ç”¨apolloï¼‰</li>
<li><a href="https://graphql.cn/" target="_blank" rel="noopener">graphql</a>ï¼šè§£æGraphQLæŸ¥è¯¢</li>
</ul>
<h3 id="å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯"><a href="#å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯" class="headerlink" title="å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯"></a>å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯</h3><p>éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯<code>apollo-boost</code>å’Œ<code>apollo-client</code>éƒ½æä¾›äº†<code>ApolloClient</code>ï¼Œä½†æ˜¯ä¸¤è€…éœ€è¦çš„å‚æ•°æœ‰ä¸€ç‚¹å·®åˆ«ã€‚å…·ä½“è§å„è‡ªAPIï¼š</p>
<ul>
<li><code>apollo-boost</code>å¯¼å‡ºçš„Apollo Clientå¯¹è±¡ï¼ˆè¯¦ç»†<a href="https://www.apollographql.com/docs/react/essentials/get-started/#configuration-options" target="_blank" rel="noopener">API</a>ï¼‰ï¼šé›†æˆå®˜æ–¹æ ¸å¿ƒåŠŸèƒ½çš„ä¸€ä¸ªå¤§é›†åˆå¯¹è±¡</li>
<li><code>apollo-client</code>å¯¼å‡ºçš„Apollo Clientå¯¹è±¡ï¼ˆè¯¦ç»†<a href="https://www.apollographql.com/docs/react/api/apollo-client/#apolloclient" target="_blank" rel="noopener">API</a>ï¼‰ï¼šé»˜è®¤ä¸ºAppæ‰€åœ¨çš„<code>åŒä¸€ä¸»æœº</code>ä¸Šçš„<code>GraphQLç«¯ç‚¹</code>ï¼Œ<br>  è¦è‡ªå®šä¹‰<code>uri</code>è¿˜éœ€å¼•å…¥<code>apollo-link-http</code>åŒ…ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯<code>apollo v1.x</code>ï¼Œå¯ç›´æ¥ä»<code>apollo-client</code>åŒ…å†…å¯¼å‡º<code>createNetworkInterface</code>æ–¹æ³•ï¼Œç”¨æ³•è¯·è§<a href="https://github.com/apollographql/apollo-link/tree/master/packages/apollo-link-http#upgrading-from-apollo-fetch--apollo-client" target="_blank" rel="noopener">1.xè¿ç§»è‡³2.xæŒ‡å—</a></li>
</ul>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨<code>apollo-boost</code>å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ApolloClient <span class="keyword">from</span> <span class="string">'apollo-boost'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä½ å®åœ¨æ‰¾ä¸åˆ°ç°æˆçš„æœåŠ¡ç«¯ï¼Œå¯ä»¥ä½¿ç”¨apolloå®˜ç½‘æä¾›çš„ï¼šhttps://48p1r2roz4.sse.codesandbox.ioæˆ–è€…æœ¬æ•™ç¨‹çš„æœåŠ¡ï¼šhttps://kdvmr.sse.codesandbox.io/</span></span><br><span class="line">    uri: <span class="string">'ä½ çš„GraphQLæœåŠ¡é“¾æ¥'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠä½¿ç”¨<code>apollo-client</code>å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ApolloClient <span class="keyword">from</span> <span class="string">'apollo-client'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createHttpLink &#125; <span class="keyword">from</span> <span class="string">'apollo-link-http'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  link: createHttpLink(&#123; </span><br><span class="line">    uri: <span class="string">'ä½ çš„GraphQLæœåŠ¡é“¾æ¥'</span> </span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ç¼–å†™GraphQLæŸ¥è¯¢è¯­å¥"><a href="#ç¼–å†™GraphQLæŸ¥è¯¢è¯­å¥" class="headerlink" title="ç¼–å†™GraphQLæŸ¥è¯¢è¯­å¥"></a>ç¼–å†™GraphQLæŸ¥è¯¢è¯­å¥</h3><blockquote>
<p>å¦‚æœå¯¹<code>GraphQL</code>è¯­æ³•ä¸æ˜¯å¾ˆäº†è§£ï¼Œè¯·å…ˆç§»æ­¥<a href="https://juejin.im/post/5b5545a0e51d4518e3119933" target="_blank" rel="noopener">graphQLåŸºç¡€å®è·µ</a></p>
</blockquote>
<p>ä¸ºäº†æ¼”ç¤ºGraphQLæŸ¥è¯¢ï¼Œæˆ‘ä»¬æš‚ä¸”ä½¿ç”¨æ™®é€šçš„è¯·æ±‚çœ‹ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; gql &#125; <span class="keyword">from</span> <span class="string">'apollo-boost'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ– Apollo å®¢æˆ·ç«¯</span></span><br><span class="line"></span><br><span class="line">client.query(&#123;</span><br><span class="line">  query: gql<span class="string">`</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      rates(currency: "CNY") &#123;</span></span><br><span class="line"><span class="string">        currency</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>
<p>é™¤äº†ä»<code>apollo-boost</code>å¯¼å…¥<code>gql</code>ï¼Œä½ è¿˜å¯ä»¥ä»<code>graphql-tag</code>è¿™ä¸ªåŒ…å¯¼å…¥ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line">gql<span class="string">`...`</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾è€Œæ˜“è§ï¼Œgql()çš„ä½œç”¨æ˜¯æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£ææˆæŸ¥è¯¢æ–‡æ¡£ã€‚</p>
<h3 id="è¿æ¥Apolloå®¢æˆ·ç«¯åˆ°React"><a href="#è¿æ¥Apolloå®¢æˆ·ç«¯åˆ°React" class="headerlink" title="è¿æ¥Apolloå®¢æˆ·ç«¯åˆ°React"></a>è¿æ¥Apolloå®¢æˆ·ç«¯åˆ°React</h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ApolloProvider &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ApolloProvider client=&#123;client&#125;&gt;</span><br><span class="line">      &lt;div&gt;App content&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>ApolloProvider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ApolloProviderï¼ˆè¯¦ç»†<a href="https://www.apollographql.com/docs/react/api/react-apollo/#apolloprovider" target="_blank" rel="noopener">API</a>ï¼‰æœ‰ä¸€ä¸ªå¿…éœ€å‚æ•°<code>client</code>ã€‚</p>
</blockquote>
<p>å’Œreduxä¸€æ ·ï¼ˆreduxä½¿ç”¨<code>&lt;Provider/&gt;</code>ç»„ä»¶åŒ…è£¹React Appï¼‰ï¼Œreact-apolloéœ€è¦<code>&lt;ApolloProvider /&gt;</code>ç»„ä»¶æ¥åŒ…è£¹æ•´ä¸ªReact Appï¼Œä»¥ä¾¿å°†å®ä¾‹åŒ–çš„<code>client</code>æ”¾åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œå°±å¯ä»¥åœ¨ç»„ä»¶æ ‘çš„ä»»ä½•ä½ç½®è®¿é—®åˆ°å®ƒã€‚<br>å¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>withApollo</code>æ¥åŒ…è£¹ç»„ä»¶ï¼Œä»¥åœ¨ç»„ä»¶å†…éƒ¨è·å–åˆ°<code>clientå®ä¾‹</code>ï¼ˆè¿˜æœ‰å¾ˆå¤šè·å–å®ä¾‹çš„æ–¹æ³•ï¼Œæ–‡æ¡£åé¢æœ‰ä»‹ç»ï¼‰ï¼Œ<br>è¯¦æƒ…è¯·å‚è€ƒ<a href="https://www.apollographql.com/docs/react/api/react-apollo/#withapollocomponent" target="_blank" rel="noopener">withApollo()</a>ã€‚</p>
<h2 id="Queryç»„ä»¶ä¸Mutationç»„ä»¶"><a href="#Queryç»„ä»¶ä¸Mutationç»„ä»¶" class="headerlink" title="Queryç»„ä»¶ä¸Mutationç»„ä»¶"></a>Queryç»„ä»¶ä¸Mutationç»„ä»¶</h2><p>åœ¨graphqlä¸­ï¼Œ<code>query</code>æ“ä½œä»£è¡¨<code>æŸ¥è¯¢</code>ï¼Œmutationæ“ä½œä»£è¡¨å¢ã€åˆ å’Œæ”¹ï¼Œä»–ä»¬å¯¹åº”<code>REST API</code>çš„GETä¸POSTè¯·æ±‚ï¼Œä½†è¦æ³¨æ„åœ¨å®é™…çš„è¯·æ±‚è¿‡ç¨‹ä¸­Queryæˆ–è®¸å¹¶ä¸æ˜¯<code>GET</code>è¯·æ±‚ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£åšçš„å‡è®¾ï¼</p>
<h3 id="è·å–æ•°æ®â€”â€”Queryç»„ä»¶"><a href="#è·å–æ•°æ®â€”â€”Queryç»„ä»¶" class="headerlink" title="è·å–æ•°æ®â€”â€”Queryç»„ä»¶"></a>è·å–æ•°æ®â€”â€”<a href="https://www.apollographql.com/docs/react/essentials/queries/" target="_blank" rel="noopener">Queryç»„ä»¶</a></h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Query &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; gql &#125; <span class="keyword">from</span> <span class="string">"apollo-boost"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ExchangeRates = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Query</span><br><span class="line">    query=&#123;gql<span class="string">`</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        rates(currency: "USD") &#123;</span></span><br><span class="line"><span class="string">          currency</span></span><br><span class="line"><span class="string">          rate</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span>&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;</span><br><span class="line">      (&#123; loading, error, data &#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (loading) <span class="keyword">return</span> &lt;p&gt;Loading...&lt;<span class="regexp">/p&gt;;</span></span><br><span class="line"><span class="regexp">        if (error) return &lt;p&gt;Error :(&lt;/</span>p&gt;;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> data.rates.map(<span class="function">(<span class="params">&#123; currency, rate &#125;</span>) =&gt;</span> (</span><br><span class="line">          &lt;div key=&#123;currency&#125;&gt;</span><br><span class="line">            &lt;p&gt;&#123;currency&#125;: &#123;rate&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        ));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/Query&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<p>æ­å–œï¼Œä½ åˆšåˆšåˆ›å»ºäº†ç¬¬ä¸€ä¸ªReact Queryç»„ä»¶ï¼ğŸ‰ğŸ‰ğŸ‰</p>
<p>ä»£ç è§£æï¼š</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Queryç»„ä»¶å†…ï¼Œæœ‰ä¸€ä¸ª<code>åŒ¿åå‡½æ•°</code>ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°æœ‰ä¸€äº›å‚æ•°ï¼Œæœ€å¸¸ç”¨çš„æœ‰ï¼š<code>loading</code>ï¼Œ<code>error</code>ï¼Œ<code>data</code>ã€‚<br>å®ƒä»¬åˆ†åˆ«ä»£è¡¨ç»„ä»¶çš„åŠ è½½çŠ¶æ€ã€ç»„ä»¶çš„åŠ è½½é”™è¯¯æç¤ºã€ä»¥åŠç»„ä»¶åŠ è½½åˆ°çš„æ•°æ®ã€‚</p>
<blockquote>
<p>Queryç»„ä»¶æ˜¯ä»<code>react-apollo</code>å¯¼å‡ºçš„<code>Reactç»„ä»¶</code>ï¼Œå®ƒä½¿ç”¨<code>render prop</code>æ¨¡å¼ä¸UIå…±äº«GraphQLæ•°æ®ã€‚ï¼ˆå³æˆ‘ä»¬å¯ä»¥ä»ç»„ä»¶çš„propsè·å–åˆ°GraphQLæŸ¥è¯¢è¿”å›çš„æ•°æ®ï¼‰<br>Queryç»„ä»¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–propsï¼Œä¸Šé¢å°±å±•ç¤ºäº†ä¸€ä¸ªqueryå±æ€§ï¼Œå…¶ä»–çš„å¦‚ï¼š</p>
<ul>
<li><code>children</code>(æ ¹æ®æŸ¥è¯¢ç»“æœæ˜¾ç¤ºè¦æ¸²æŸ“çš„UI)</li>
<li><code>variables</code>ï¼ˆç”¨æ¥ä¼ é€’æŸ¥è¯¢å‚æ•°åˆ°gql()ï¼‰</li>
<li><code>skip</code>ï¼ˆè·³è¿‡è¿™ä¸ªæŸ¥è¯¢ï¼Œæ¯”å¦‚ç™»å½•æ—¶ï¼ŒéªŒè¯å¤±è´¥ï¼Œæˆ‘ä»¬ä½¿ç”¨skipè·³è¿‡è¿™ä¸ªæŸ¥è¯¢ï¼Œåˆ™ç™»å½•å¤±è´¥ï¼‰</li>
</ul>
<p>æ›´å¤špropsè¯¦è§<a href="https://www.apollographql.com/docs/react/essentials/queries/#query-api-overview" target="_blank" rel="noopener">Query API</a></p>
</blockquote>
<h3 id="æ›´æ–°æ•°æ®â€”â€”Mutationç»„ä»¶"><a href="#æ›´æ–°æ•°æ®â€”â€”Mutationç»„ä»¶" class="headerlink" title="æ›´æ–°æ•°æ®â€”â€”Mutationç»„ä»¶"></a>æ›´æ–°æ•°æ®â€”â€”<a href="https://www.apollographql.com/docs/react/essentials/mutations/" target="_blank" rel="noopener">Mutationç»„ä»¶</a></h3><p>æ›´æ–°æ•°æ®åŒ…æ‹¬æ–°å¢ã€ä¿®æ”¹å’Œåˆ é™¤ï¼Œè¿™äº›æ“ä½œç»Ÿä¸€ä½¿ç”¨Mutationç»„ä»¶ã€‚<br>Mutationç»„ä»¶å’ŒQueryç»„ä»¶ä¸€æ ·ï¼Œä½¿ç”¨<code>render prop</code>æ¨¡å¼ï¼Œä½†propsæœ‰å·®åˆ«ï¼Œ<a href="https://www.apollographql.com/docs/react/essentials/mutations/#mutation-api-overview" target="_blank" rel="noopener">Mutation API</a></p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Mutation &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ADD_TODO = gql<span class="string">`</span></span><br><span class="line"><span class="string">  mutation AddTodo($type: String!) &#123;</span></span><br><span class="line"><span class="string">    addTodo(type: $type) &#123;</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      type</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AddTodo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> input;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Mutation mutation=&#123;ADD_TODO&#125;&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        (addTodo, &#123; data &#125;) =&gt; (</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;form</span><br><span class="line">              onSubmit=&#123;<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                addTodo(&#123; variables: &#123; <span class="keyword">type</span>: input.value &#125; &#125;);</span><br><span class="line">                input.value = <span class="string">""</span>;</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;input</span><br><span class="line">                ref=&#123;<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">                  input = node;</span><br><span class="line">                &#125;&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">              &lt;button <span class="keyword">type</span>=<span class="string">"submit"</span>&gt;Add Todo&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>form&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Mutation&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ä»£ç ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œåˆ›å»ºç”¨äº<code>mutation</code>ï¼ˆçªå˜ï¼‰çš„GraphQLï¼Œmutationéœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°<code>type</code>ã€‚å®ƒå°†ç”¨äºmutationçš„GraphQLè¯­å¥åŒ…è£…åœ¨<code>gql</code>æ–¹æ³•ä¸­ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™<code>Mutationç»„ä»¶</code>çš„<code>props</code>ã€‚</li>
<li><code>Mutationç»„ä»¶</code>å†…éœ€è¦ä¸€ä¸ª<code>åŒ¿åå‡½æ•°</code>ä½œä¸º<code>å­å‡½æ•°</code>ï¼ˆä¹Ÿç§°ä¸ºrender propå‡½æ•°ï¼‰ï¼ŒåŒQueryç»„ä»¶ï¼Œä½†å‚æ•°æœ‰å·®å¼‚ã€‚</li>
<li><code>render propå‡½æ•°</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>Mutationç»„ä»¶</code>å†…éƒ¨å®šä¹‰çš„<code>mutate()</code>å‡½æ•°ã€‚ä¸ºäº†æé«˜ä»£ç å¯è¯»æ€§ï¼Œè¿™é‡Œå–åä¸º<code>addTodo</code>ã€‚<br>  ä¹Ÿå¯ä»¥ç›´æ¥ç”¨<code>â€œmutateâ€</code>è¡¨ç¤ºmutateå‡½æ•°ï¼Œé€šè¿‡è°ƒç”¨å®ƒæ¥å‘Šè¯‰<code>Apollo Client</code>ï¼Œæ¥ä¸‹æ¥è¦è§¦å‘mutationï¼ˆå³è§¦å‘æäº¤è¡¨å•çš„POSTè¯·æ±‚ï¼Œåœ¨onSubmitäº‹ä»¶é‡Œé¢å¯ä»¥çœ‹è§addTodoå‡½æ•°è¢«è°ƒç”¨äº†ï¼‰ã€‚</li>
<li><code>render propå‡½æ•°</code>çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå±æ€§ï¼ŒåŒ…æ‹¬dataï¼ˆmutationçš„ç»“æœï¼ŒPOSTè¯·æ±‚çš„è¿”å›å€¼ï¼‰ã€loadingï¼ˆåŠ è½½çŠ¶æ€ï¼‰å’Œerrorï¼ˆåŠ è½½è¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯ï¼‰ï¼ŒåŒ<code>Queryç»„ä»¶</code>ã€‚</li>
</ul>
<blockquote>
<p><code>mutateå‡½æ•°</code>ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢å‘½åçš„<code>addTodo</code>å‡½æ•°ï¼‰å¯é€‰åœ°æ¥å—å˜é‡ï¼Œå¦‚ï¼š</p>
<ul>
<li>optimisticResponse</li>
<li>refetchQuerieså’Œupdateï¼ˆè¿™äº›å‡½æ•°å°±æ˜¯åé¢ç”¨æ¥æ›´æ–°ç¼“å­˜çš„ï¼‰</li>
<li>ignoreResultsï¼šå¿½ç•¥mutationæ“ä½œè¿”å›çš„ç»“æœï¼ˆå³å¿½ç•¥POSTè¯·æ±‚çš„è¿”å›å€¼ï¼‰</li>
</ul>
<p>ä½ ä¹Ÿå¯ä»¥å°†è¿™äº›å€¼ä½œä¸º<code>props</code>ä¼ é€’ç»™<code>Mutationç»„ä»¶</code>ã€‚è¯¦ç»†çš„ä»‹ç»è¯·ç§»æ­¥<a href="https://www.apollographql.com/docs/react/api/react-apollo/#graphql-options-for-mutations" target="_blank" rel="noopener">mutateå‡½æ•° API</a></p>
</blockquote>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬èƒ½å‘å‡ºå®¢æˆ·ç«¯è¯·æ±‚ï¼Œä¹Ÿèƒ½å¾—åˆ°æœåŠ¡å™¨è¿”å›çš„ç»“æœï¼Œé‚£æ¥ä¸‹æ¥å°±ç€æ‰‹æ€ä¹ˆå¤„ç†è¿™äº›æ•°æ®ï¼Œç„¶åæ¸²æŸ“åˆ°UIä¸Šã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>redux</code>åœ¨è¿™ä¸€æ­¥æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š</p>
<ul>
<li>dispatchè§¦å‘æ•°æ®è¯·æ±‚</li>
<li>reduceræ ¹æ®ä¹‹å‰å®šä¹‰çš„actionå¤„ç†å¾—åˆ°çš„æ–°æ•°æ®ï¼ŒæŠŠæ•°æ®ä¿å­˜åˆ°storeä¸­</li>
<li>react-reduxçš„connectè¿æ¥storeä¸Reactç»„ä»¶</li>
<li>mapStateToProps/mapDisToPropså®Œæˆrender propã€‚</li>
</ul>
<p>ä»¥ä¸Šæ­¥éª¤ï¼Œå…¨é ä¸€è¡Œä¸€è¡Œçš„ä»£ç æ‰‹åŠ¨å®ç°ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹apolloæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š</p>
<ul>
<li>cache.writeQuery()</li>
</ul>
<p>æ²¡é”™ï¼Œä½ æ²¡çœ‹é”™ï¼Œå°±æ˜¯è¿™ä¸€ä¸ªAPIï¼Œæå®šä»¥ä¸Š<code>redux</code>éœ€è¦ä¸€å¤§å †ä»£ç æ‰èƒ½å®Œæˆçš„æ•°æ®æ›´æ–°ï¼writeQueryç›¸å½“äºé€šè¿‡ä¸€ç§æ–¹å¼æ¥å‘Šè¯‰Apollo Clientï¼š<br><code>æˆ‘ä»¬å·²ç»æˆåŠŸå‘å‡ºPOSTè¯·æ±‚å¹¶å¾—åˆ°äº†è¿”å›çš„ç»“æœäº†ï¼Œç°åœ¨æŠŠç»“æœç»™ä½ ï¼Œä½ æ›´æ–°ä¸€ä¸‹æœ¬åœ°çš„ç¼“å­˜å§ï¼</code><br>å¹¶ä¸”å¦‚æœä½ çš„æ•°æ®å†™å¾—å¾ˆè§„èŒƒï¼ˆå‘ƒï¼Œå…¶å®å®ƒå«<code>èŒƒå¼åŒ–</code>ï¼Œä¸è¦æ€¥ï¼Œåé¢æœ‰ä»‹ç»ï¼‰ï¼Œç”šè‡³è¿è¿™ä¸€å¥è¯éƒ½ä¸ç”¨å†™ï¼Œå½“ä½ æ‰§è¡Œqueryæˆ–mutationåï¼ŒUIä¾¿ä¼šè‡ªåŠ¨æ ¹æ®æ–°çš„æ•°æ®æ›´æ–°UIï¼ï¼</p>
<h3 id="æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query"><a href="#æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query" class="headerlink" title="æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query"></a>æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query</h3><p>æœ‰æ—¶ï¼Œå½“æ‰§è¡Œmutationæ—¶ï¼ŒGraphQLæœåŠ¡å™¨å’ŒApolloç¼“å­˜ä¼šå˜å¾—ä¸åŒæ­¥ã€‚å½“æ‰§è¡Œçš„æ›´æ–°å–å†³äºæœ¬åœ°ç¼“å­˜ä¸­å·²æœ‰çš„æ•°æ®æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ä¾‹å¦‚ï¼Œæœ¬åœ°ç¼“å­˜äº†ä¸€å¼ åˆ—è¡¨ï¼Œ<br>å½“åˆ é™¤åˆ—è¡¨ä¸­çš„ä¸€é¡¹æˆ–æ·»åŠ ä¸€é¡¹æ–°çš„æ•°æ®ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œmutationåï¼ŒgraphqlæœåŠ¡ç«¯å’Œæœ¬åœ°ç¼“å­˜ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘Šè¯‰Apollo Clientå»æ›´æ–°é¡¹ç›®åˆ—è¡¨çš„æŸ¥è¯¢ï¼Œ<br>ä»¥è·å–æˆ‘ä»¬mutationåæ–°çš„é¡¹ç›®åˆ—è¡¨æ•°æ®ï¼›åˆæˆ–è€…æˆ‘ä»¬ä»…ä»…ä½¿ç”¨mutationæäº¤ä¸€å¼ è¡¨å•ï¼Œæœ¬åœ°å¹¶æ²¡æœ‰ç¼“å­˜è¿™å¼ è¡¨å•çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦æ–°çš„æŸ¥è¯¢æ¥æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚</p>
<p>ä¸‹é¢æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Mutation &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ADD_TODO = gql<span class="string">`</span></span><br><span class="line"><span class="string">  mutation AddTodo($type: String!) &#123;</span></span><br><span class="line"><span class="string">    addTodo(type: $type) &#123;</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      type</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GET_TODOS = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query GetTodos &#123;</span></span><br><span class="line"><span class="string">    todos</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AddTodo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> input;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Mutation</span><br><span class="line">      mutation=&#123;ADD_TODO&#125;</span><br><span class="line">      update=&#123;<span class="function">(<span class="params">cache, &#123; data: &#123; addTodo &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; todos &#125; = cache.readQuery(&#123; query: GET_TODOS &#125;);</span><br><span class="line">        cache.writeQuery(&#123;</span><br><span class="line">          query: GET_TODOS,</span><br><span class="line">          data: &#123; todos: todos.concat([addTodo]) &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;<span class="function"><span class="params">addTodo</span> =&gt;</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;form</span><br><span class="line">            onSubmit=&#123;<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">              e.preventDefault();</span><br><span class="line">              addTodo(&#123; variables: &#123; <span class="keyword">type</span>: input.value &#125; &#125;);</span><br><span class="line">              input.value = <span class="string">""</span>;</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              ref=&#123;<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">                input = node;</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;button <span class="keyword">type</span>=<span class="string">"submit"</span>&gt;Add Todo&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>form&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      )&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Mutation&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ®µä»£ç å¯ä»¥çœ‹è§ï¼Œ<code>update()</code>å‡½æ•°å¯ä»¥ä½œä¸ºpropsä¼ é€’ç»™Mutationç»„ä»¶ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä½œä¸ºpropä¼ é€’ç»™mutateå‡½æ•°ï¼Œå³ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å€Ÿç”¨ä¸Šé¢çš„mutateï¼ˆé‡å‘½åä¸ºaddTodoï¼‰å‡½æ•°æ¥ä¸¾ä¾‹</span></span><br><span class="line">addTodo(&#123;</span><br><span class="line">  variables: &#123; <span class="keyword">type</span>: input.value &#125;,</span><br><span class="line">  update: <span class="function">(<span class="params">cache, data: &#123; addTodo &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><code>update</code>: (cache: DataProxy, mutationResult: FetchResult)</strong>ï¼šç”¨äºåœ¨å‘ç”Ÿçªå˜ï¼ˆmutationï¼‰åæ›´æ–°ç¼“å­˜</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li><code>cache</code>ï¼Œè¿™ä¸ªå‚æ•°è¯¦ç»†è®²åˆå¯ä»¥è®²å‡ èŠ‚è¯¾ï¼Œæ‰€ä»¥è¿™é‡Œåªç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œè¯¦ç»†<a href="https://www.apollographql.com/docs/react/advanced/caching/#inmemorycache" target="_blank" rel="noopener">API</a><ul>
<li>cacheé€šå¸¸æ˜¯<code>InMemoryCache</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨åˆ›å»ºApollo Clientæ—¶æä¾›ç»™Apollo Clientçš„æ„é€ å‡½æ•°ï¼ˆæ€ä¹ˆåˆ›å»ºçš„Apollo Clientï¼Ÿè¯·è¿”å›<a href="#åˆ›å»ºä¸€ä¸ªapolloå®¢æˆ·ç«¯">åˆ›å»ºä¸€ä¸ªapolloå®¢æˆ·ç«¯</a>å¤ä¹ ä¸€ä¸‹ï¼‰</li>
<li><code>InMemoryCache</code>æ¥è‡ªäºä¸€ä¸ªå•ç‹¬çš„åŒ…<code>apollo-cache-inmemory</code>ã€‚å¦‚æœä½ ä½¿ç”¨<code>apollo-boost</code>ï¼Œè¿™ä¸ªåŒ…å·²ç»è¢«åŒ…å«åœ¨é‡Œé¢äº†ï¼Œæ— éœ€é‡å¤å®‰è£…ã€‚</li>
<li>cacheæœ‰å‡ ä¸ªå®ç”¨å‡½æ•°ï¼Œä¾‹å¦‚<code>cache.readQuery</code>å’Œ<code>cache.writeQuery</code>ï¼Œå®ƒä»¬å…è®¸æ‚¨ä½¿ç”¨GraphQLè¯»å–å’Œå†™å…¥ç¼“å­˜ã€‚</li>
<li>å¦å¤–è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•ï¼Œä¾‹å¦‚<code>cache.readFragment</code>ï¼Œ<code>cache.writeFragment</code>å’Œ<code>cache.writeData</code>ï¼Œè¯¦ç»†<a href="(https://www.apollographql.com/docs/react/advanced/caching/#inmemorycache">API</a>)ã€‚</li>
</ul>
</li>
<li><code>mutationResult</code>ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é‡Œé¢çš„dataå±æ€§ä¿å­˜ç€æ‰§è¡Œmutationåçš„ç»“æœï¼ˆPOSTè¯·æ±‚åå¾—åˆ°çš„æ•°æ®ï¼‰ï¼Œè¯¦ç»†<a href="https://www.apollographql.com/docs/react/essentials/mutations/#render-prop-function" target="_blank" rel="noopener">API</a><ul>
<li>å¦‚æœæŒ‡å®š<a href="https://www.apollographql.com/docs/react/features/optimistic-ui/" target="_blank" rel="noopener">ä¹è§‚å“åº”</a>ï¼Œåˆ™ä¼šæ›´æ–°ä¸¤æ¬¡<code>update</code>å‡½æ•°ï¼šä¸€æ¬¡æ˜¯ä¹è§‚ç»“æœï¼Œå¦ä¸€æ¬¡æ˜¯å®é™…ç»“æœã€‚</li>
<li>æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨çš„å˜å¼‚ç»“æœæ¥ä½¿ç”¨<code>cache.writeQuery</code>æ›´æ–°ç¼“å­˜ã€‚</li>
</ul>
</li>
</ul>
<p>å¯¹äº<code>updateå‡½æ•°</code>ï¼Œå½“ä½ åœ¨å…¶å†…éƒ¨è°ƒç”¨<code>cache.writeQuery</code>æ—¶ï¼Œæ›´æ–°æ“ä½œä¼šè§¦å‘Apolloå†…éƒ¨çš„<code>å¹¿æ’­æŸ¥è¯¢</code>ï¼ˆbroadcastQueriesï¼‰ï¼Œè€Œå¹¿æ’­æŸ¥è¯¢åˆä¼šè§¦å‘ç¼“å­˜ä¸­ä¸æœ¬æ¬¡mutationç›¸å…³çš„æ•°æ®çš„è‡ªåŠ¨æ›´æ–°â€”â€”è‡ªåŠ¨ä½¿ç”¨å—å½±å“ç»„ä»¶çš„GraphQLè¿›è¡ŒæŸ¥è¯¢å¹¶æ›´æ–°UIã€‚<br>å› æ­¤å½“æ‰§è¡Œmutationåï¼Œæˆ‘ä»¬ä¸å¿…æ‰‹åŠ¨å»æ‰§è¡Œç›¸å…³ç»„ä»¶çš„æŸ¥è¯¢ï¼ŒApollo Clientåœ¨å†…éƒ¨å·²ç»åšå¥½äº†æ‰€æœ‰å·¥ä½œï¼Œè¿™åŒºåˆ«äºreduxåœ¨dispatchåæ‰€åšçš„ä¸€åˆ‡å¤„ç†æ•°æ®çš„å·¥ä½œã€‚</p>
<p>æœ‰æ—¶ï¼Œupdateå‡½æ•°ä¸éœ€è¦ä¸ºæ‰€æœ‰mutationæ›´æ–°ç¼“å­˜ï¼ˆæ¯”å¦‚æäº¤äº†ä¸€å¼ è¡¨å•ï¼‰ã€‚æ‰€ä»¥ï¼ŒApolloæä¾›å•ç‹¬çš„<code>cache.writeQuery</code>æ–¹æ³•ï¼Œæ¥è§¦å‘ç›¸å…³ç¼“å­˜çš„æŸ¥è¯¢ï¼Œä»¥æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚<br>æ‰€ä»¥éœ€è¦æ³¨æ„ï¼š<code>ä»…ä»…åªåœ¨updateå‡½æ•°å†…éƒ¨è°ƒç”¨cache.writeQuery()æ‰ä¼šè§¦å‘å¹¿æ’­è¡Œä¸º</code>ã€‚åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹ï¼Œcache.writeQueryåªä¼šå†™å…¥ç¼“å­˜ï¼Œå¹¶ä¸”æ‰€åšçš„æ›´æ”¹ä¸ä¼šå¹¿æ’­åˆ°è§†å›¾å±‚ã€‚<br>ä¸ºäº†é¿å…ç»™ä»£ç é€ æˆæ··æ·†ï¼Œæ¨èåœ¨æœªä½¿ç”¨updateå‡½æ•°æ—¶ï¼Œä½¿ç”¨Apollo Clientå®ä¾‹å¯¹è±¡<code>client</code>çš„<code>client.writeQuery</code>æ–¹æ³•å°†æ•°æ®å†™å…¥ç¼“å­˜ã€‚</p>
</blockquote>
<p>è§£æä»£ç ï¼š</p>
<p>ç”±äºæˆ‘ä»¬éœ€è¦æ›´æ–°æ˜¾ç¤ºTODOSåˆ—è¡¨çš„æŸ¥è¯¢ï¼Œå› æ­¤é¦–å…ˆä½¿ç”¨<code>cache.readQuery</code>ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚<br>ç„¶åï¼Œæˆ‘ä»¬å°†mutationåå¾—åˆ°çš„æ–°todoä¸ç°æœ‰todoåˆ—è¡¨åˆå¹¶èµ·æ¥ï¼Œå¹¶ä½¿ç”¨<code>cache.writeQuery</code>å°†æŸ¥è¯¢åˆ°çš„æ•°æ®å†™å›ç¼“å­˜ã€‚<br>æ—¢ç„¶æˆ‘ä»¬å·²ç»æŒ‡å®šäº†ä¸€ä¸ª<code>updateå‡½æ•°</code>ï¼Œé‚£ä¹ˆä¸€æ—¦æ–°çš„todoä»æœåŠ¡å™¨è¿”å›ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢å°±ä¼šç”¨å®ƒè¿›è¡Œå“åº”æ€§æ›´æ–°ï¼ˆå¹¿æ’­ç»™å…¶ä»–ä¸æ­¤ç¼“å­˜æ•°æ®æœ‰å…³çš„ç»„ä»¶çš„GraphQLæŸ¥è¯¢ï¼Œè®©ä»–ä»¬åŠæ—¶æ›´æ–°æ›´æ–°ç›¸å…³ç¼“å­˜åˆ°UIä¸Šï¼‰ã€‚</p>
<blockquote>
<p>Apolloè¿˜æä¾›ä¸€ç§çš„æ–¹æ³•æ¥åŠæ—¶åœ°ä¿®æ”¹æœ¬åœ°ç¼“å­˜ä»¥å¿«é€Ÿæ¸²æŸ“UIå¹¶è§¦å‘ç›¸å…³ç¼“å­˜çš„æŸ¥è¯¢ï¼Œå¾…æŸ¥è¯¢è¿”å›æ–°çš„æ•°æ®åå†çœŸæ­£æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œè¯¦è§<a href="https://www.apollographql.com/docs/react/features/optimistic-ui/" target="_blank" rel="noopener">ä¹è§‚æ›´æ–°</a>ã€‚</p>
<p>åŸºäº<code>ä¹è§‚UI</code>ï¼Œå¦‚æœæ‚¨è¿è¡Œç›¸åŒçš„æŸ¥è¯¢ä¸¤æ¬¡ï¼Œåˆ™ä¸ä¼šçœ‹åˆ°åŠ è½½æŒ‡ç¤ºç¬¦ï¼ˆApollo Clientè¿”å›çš„loadingå­—æ®µï¼‰ã€‚apolloä¼šæ£€æµ‹å½“å‰çš„è¯·æ±‚å‚æ•°æ˜¯å¦å˜åŒ–ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å‘æœåŠ¡å™¨å‘é€æ–°çš„è¯·æ±‚ã€‚</p>
</blockquote>
<h3 id="ApolloèŒƒå¼åŒ–ç¼“å­˜-API"><a href="#ApolloèŒƒå¼åŒ–ç¼“å­˜-API" class="headerlink" title="ApolloèŒƒå¼åŒ–ç¼“å­˜ API"></a>ApolloèŒƒå¼åŒ–ç¼“å­˜ <a href="https://www.apollographql.com/docs/react/advanced/caching/#normalization" target="_blank" rel="noopener">API</a></h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Mutation, Query &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UPDATE_TODO = gql<span class="string">`</span></span><br><span class="line"><span class="string">  mutation UpdateTodo($id: String!, $type: String!) &#123;</span></span><br><span class="line"><span class="string">    updateTodo(id: $id, type: $type) &#123;</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      type</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šè¿™é‡Œé€šè¿‡graphqlå¾—åˆ°çš„todosæ•°æ®æ˜¯ä¸€ä¸ªåŒ…å«idå’Œtypeå­—æ®µçš„å¯¹è±¡çš„æ•°ç»„ï¼Œä¸ UPDATE_TODO é‡Œé¢çš„å­—æ®µï¼ˆä¸»è¦æ˜¯idï¼‰å¯¹åº”</span></span><br><span class="line"><span class="keyword">const</span> GET_TODOS = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query GetTodos &#123;</span></span><br><span class="line"><span class="string">    todos</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Todos = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Query query=&#123;GET_TODOS&#125;&gt;</span><br><span class="line">    &#123;<span class="function">(<span class="params">&#123; loading, error, data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (loading) <span class="keyword">return</span> &lt;p&gt;Loading...&lt;<span class="regexp">/p&gt;;</span></span><br><span class="line"><span class="regexp">      if (error) return &lt;p&gt;Error :(&lt;/</span>p&gt;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data.todos.map(<span class="function">(<span class="params">&#123; id, <span class="keyword">type</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> input;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          &lt;Mutation mutation=&#123;UPDATE_TODO&#125; key=&#123;id&#125;&gt;</span><br><span class="line">            &#123;<span class="function"><span class="params">updateTodo</span> =&gt;</span> (</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;p&gt;&#123;<span class="keyword">type</span>&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;form</span></span><br><span class="line"><span class="regexp">                  onSubmit=&#123;e =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                    e.preventDefault();</span></span><br><span class="line"><span class="regexp">                    updateTodo(&#123; variables: &#123; id, type: input.value &#125; &#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    input.value = "";</span></span><br><span class="line"><span class="regexp">                  &#125;&#125;</span></span><br><span class="line"><span class="regexp">                &gt;</span></span><br><span class="line"><span class="regexp">                  &lt;input</span></span><br><span class="line"><span class="regexp">                    ref=&#123;node =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                      input = node;</span></span><br><span class="line"><span class="regexp">                    &#125;&#125;</span></span><br><span class="line"><span class="regexp">                  /</span>&gt;</span><br><span class="line">                  &lt;button <span class="keyword">type</span>=<span class="string">"submit"</span>&gt;Update Todo&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>form&gt;</span><br><span class="line">              &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            )&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Mutation&gt;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  &lt;<span class="regexp">/Query&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šè¿™ä¸€æ¬¡åœ¨<code>mutateå‡½æ•°</code>ï¼ˆè¿™é‡Œå‘½åä¸º<code>updateTodo</code>ï¼‰é‡Œå¹¶æ²¡æœ‰è°ƒç”¨updateå‡½æ•°ï¼Œåœ¨ä¹Ÿæ²¡æœ‰ä¼ é€’updateå‡½æ•°ç»™Mutationç»„ä»¶ï¼Œä½†æ˜¯UIä¼šç«‹å³æ›´æ–°ã€‚è¿™å°±æ˜¯èŒƒå¼åŒ–ç¼“å­˜çš„é­…åŠ›äº†ã€‚</p>
<blockquote>
<p><code>èŒƒå¼åŒ–ç¼“å­˜</code>â€”â€”<code>InMemoryCache</code>åœ¨å°†æ•°æ®ä¿å­˜åˆ°å­˜å‚¨ä¹‹å‰å¯¹æ•°æ®è¿›è¡ŒèŒƒå¼åŒ–ï¼Œæ–¹æ³•æ˜¯å°†ç»“æœæ‹†åˆ†ä¸ºå•ä¸ªå¯¹è±¡ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¹¶å°†è¿™äº›å¯¹è±¡å­˜å‚¨åœ¨å±•å¹³çš„æ•°æ®ç»“æ„ä¸­ï¼ˆåˆ›å»ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ä¸ºè¿™äº›å¯¹è±¡çš„é”®ï¼Œæˆä¸ºç¼“å­˜é”®ï¼‰ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>InMemoryCache</code>å°†å°è¯•ä½¿ç”¨å¸¸è§çš„<code>id</code>å’Œ<code>_idçš„ä¸»é”®</code>ä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¦‚æœå®ƒä»¬ä¸å¯¹è±¡ä¸Šçš„<code>__typename</code>å­—æ®µä¸€èµ·å­˜åœ¨ï¼‰ã€‚</p>
<p><img src="/images/React-GraphQL-apollo-client/ROOT_QUERY.png" alt=""></p>
<p><img src="/images/React-GraphQL-apollo-client/id&amp;typename.png" alt=""></p>
<p>å¦‚æœæœªæŒ‡å®š<code>id</code>å’Œ<code>_id</code>ï¼Œæˆ–è€…æœªæŒ‡å®š<code>__typename</code>ï¼Œåˆ™<code>InMemoryCache</code>å°†æŒ‰ç…§æŸ¥è¯¢åˆ°å¯¹è±¡çš„å±‚çº§å…³ç³»ä¾æ¬¡å›é€€åˆ°æ ¹æŸ¥è¯¢ä¸ºæ­¢ã€‚</p>
<p><img src="/images/React-GraphQL-apollo-client/__typename.png" alt=""></p>
<p>ä¾‹å¦‚<code>ROOT_QUERY.allPeople.0</code>å°†ä½œä¸ºæ•°æ®ä¸­<code>allPeople[0]</code>å¯¹è±¡çš„ç¼“å­˜é”®ï¼ˆcache keyï¼‰è¢«å­˜å‚¨åˆ°ç¼“å­˜çš„æ ¹æŸ¥è¯¢ï¼ˆROOT_QUERYï¼‰ä¸‹ã€‚ï¼ˆåœ¨å±•å¹³çš„æ•°æ®ç»“æ„ä¸­ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½åœ¨<code>ROOT_QUERY</code>ä¸‹ï¼‰ï¼š</p>
<p><code>å³ä½¿æˆ‘ä»¬ä¸æ‰“ç®—åœ¨æˆ‘ä»¬çš„UIä¸­ä½¿ç”¨mutationè¿”å›çš„ç»“æœï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦è¿”å›æ›´æ–°çš„IDå’Œå±æ€§</code>ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„UIè¿›è¡Œè‡ªåŠ¨æ›´æ–°ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŒ‡å®š<code>updateå‡½æ•°</code>ï¼Œå› ä¸ºTODOSæŸ¥è¯¢å°†ä½¿ç”¨ç¼“å­˜ä¸­æ›´æ–°çš„TODOæ•°æ®è‡ªåŠ¨é‡å»ºæŸ¥è¯¢ç»“æœã€‚</p>
<blockquote>
<p>ç»“åˆä¸Šä¸€èŠ‚ä»‹ç»çš„<code>updateå‡½æ•°</code>é‚£æ ·â€”â€”å¹¶éæ¯æ¬¡mutationéƒ½éœ€è¦ä½¿ç”¨updateå‡½æ•°â€”â€”å…¶åŸå› å°±æ˜¯ä¾æ®Apollo Cacheçš„èŒƒå¼åŒ–æ•°æ®ç»“æ„ï¼Œ<br>åœ¨å°½é‡å‡å°‘æ‰‹åŠ¨æ“ä½œæ•°æ®çš„æƒ…å†µä¸‹è‡ªåŠ¨æ›´æ–°UIï¼Œå½“å‰åç«¯éƒ½è§„èŒƒåŒ–æ•°æ®åï¼ˆç‰¹åˆ«æ˜¯å”¯ä¸€æ ‡è¯†ç¬¦<code>id</code>çš„ç»Ÿä¸€, <code>__typename</code>å­—æ®µçš„å®šä¹‰ï¼‰ï¼Œ<br>åœ¨<code>query</code>æˆ–<code>mutation</code>æ“ä½œåï¼Œæˆ‘ä»¬å‡ ä¹ä¸ç”¨æ‰‹åŠ¨å¤„ç†æ•°æ®ï¼Œå°±èƒ½å®ç°UIçš„è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>ä¾‹å¦‚ï¼šå¦‚æœåªéœ€è¦æ›´æ–°ç¼“å­˜é‡Œé¢çš„å•æ¡æ•°æ®ï¼Œåªéœ€è¦è¿”å›è¿™æ¡æ•°æ®çš„IDå’Œè¦æ›´æ–°çš„å±æ€§å³å¯ï¼Œè¿™ç§æƒ…å†µä¸‹é€šå¸¸ä¸éœ€è¦ä½¿ç”¨updateå‡½æ•°ã€‚</p>
</blockquote>
<p>å¦‚æœæƒ³è¦è‡ªå®šä¹‰å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå³ä¸ç”¨é»˜è®¤çš„<code>ID</code>æ¥ç”Ÿæˆç¼“å­˜é”®ï¼Œå¯ä»¥ä½¿ç”¨<code>InMemoryCache</code>æ„é€ å‡½æ•°çš„<code>dataIdFromObject</code>å‡½æ•°ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> InMemoryCache(&#123;</span><br><span class="line">  dataIdFromObject: <span class="function"><span class="params">object</span> =&gt;</span> object.key || <span class="literal">null</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åœ¨æŒ‡å®šè‡ªå®šä¹‰dataIdFromObjectæ—¶ï¼ŒApollo Clientä¸ä¼šå°†ç±»å‹åç§°æ·»åŠ åˆ°ç¼“å­˜é”®ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨çš„<code>ID</code>åœ¨æ‰€æœ‰å¯¹è±¡ä¸­ä¸å”¯ä¸€ï¼Œåˆ™å¯èƒ½éœ€è¦åœ¨<code>dataIdFromObject</code>ä¸­åŒ…å«<code>__typename</code>ã€‚</p>
<p>åœ¨è°·æ­Œæµè§ˆå™¨ä¸­å®‰è£…<a href="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm" target="_blank" rel="noopener">apollo devtools</a>æ‰©å±•(éœ€è¦ç§‘å­¦ä¸Šç½‘)ï¼Œå¯ä»¥æ¸…æ™°çœ‹åˆ°è¿™ç§èŒƒå¼åŒ–ç¼“å­˜çš„å­˜å‚¨çŠ¶æ€ã€‚</p>
<h2 id="ä¸­åœºä¼‘æ¯"><a href="#ä¸­åœºä¼‘æ¯" class="headerlink" title="ä¸­åœºä¼‘æ¯"></a>ä¸­åœºä¼‘æ¯</h2><p><strong>ä½¿ç”¨<code>redux</code>ç®¡ç†çŠ¶æ€ï¼Œé‡å¿ƒæ˜¯æ”¾åœ¨å¦‚ä½•å»æ‹¿æ•°æ®ä¸Šï¼›è€Œ<code>apollo</code>æŠŠé‡å¿ƒæ”¾åœ¨éœ€è¦ä»€ä¹ˆæ•°æ®ä¸Šã€‚ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼</strong></p>
<p>è¿˜è®°å¾—è¿™å¥è¯å—ï¼Ÿæˆ‘ä»¬åœ¨æœ¬æ–‡æ¡£å¼€ç¯‡çš„æ—¶å€™ä»‹ç»è¿‡ã€‚ç°åœ¨ç†è§£äº†å—ï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥æ¢³ç†ä¸€ä¸‹è‡ªå·±å­¦åˆ°çš„çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>å½“å­¦ä¹ äº†æ€æ ·å»è·å–æ•°æ®ï¼ˆqueryï¼‰ä»¥åŠæ›´æ–°æ•°æ®å’Œä¿®æ”¹æ•°æ®ï¼ˆmutationï¼‰åï¼ŒåŸæ¥Apolloå’ŒReactç»“åˆï¼ŒåŸæ¥ç»„ä»¶å¯ä»¥è¿™ä¹ˆç®€å•çš„ä¸æ•°æ®äº¤äº’ï¼</li>
<li>å½“å­¦ä¹ äº†Apolloç¼“å­˜åï¼Œæˆ‘ä»¬å¯¹Apolloæ•°æ®å­˜å‚¨çš„ç†è§£åˆä¸Šå‡äº†ä¸€ä¸ªå°é˜¶ï¼ŒæŠŠæ‰€æœ‰æŸ¥è¯¢å›æ¥çš„å¯¹è±¡ä¸€ä¸€æ‹†åˆ†ï¼Œé€šè¿‡å”¯ä¸€æ ‡è¯†ç¬¦çš„å½¢å¼æŠŠä¸€ä¸ªæ·±å±‚çº§çš„å¯¹è±¡å±•å¹³ï¼Œç›´è§‚å±•ç°åœ¨ç¼“å­˜çš„æ ¹æŸ¥è¯¢ä¸­ã€‚</li>
<li>å½“å­¦ä¹ äº†Apolloçš„èŒƒå¼åŒ–ç¼“å­˜åï¼Œæˆ‘ä»¬æ‰çŸ¥é“ï¼ŒåŸæ¥è‡ªåŠ¨æ›´æ–°UIå¯ä»¥å¦‚æ­¤ä¼˜é›…ï¼æˆ‘ä»¬ç”šè‡³ä¸éœ€è¦ç®¡ç†æ•°æ®ï¼Œåªéœ€æŒ‰ç…§è§„èŒƒä¼ é€’æ•°æ®å³å¯ï¼</li>
</ul>
<h2 id="æœ¬åœ°çŠ¶æ€ç®¡ç†-è¯¦æƒ…"><a href="#æœ¬åœ°çŠ¶æ€ç®¡ç†-è¯¦æƒ…" class="headerlink" title="æœ¬åœ°çŠ¶æ€ç®¡ç† è¯¦æƒ…"></a>æœ¬åœ°çŠ¶æ€ç®¡ç† <a href="https://www.apollographql.com/docs/react/essentials/local-state/" target="_blank" rel="noopener">è¯¦æƒ…</a></h2><p>ä¸ŠåŠåœºæˆ‘ä»¬æ¥è§¦äº†<code>æœ¬åœ°ä¸æœåŠ¡ç«¯</code>çš„è¿œç¨‹æ•°æ®äº¤äº’ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›å…¥<code>æœ¬åœ°çš„çŠ¶æ€ç®¡ç†</code>ã€‚</p>
<p>Apollo Clientåœ¨<code>2.5ç‰ˆæœ¬</code>å…·æœ‰å†…ç½®çš„æœ¬åœ°çŠ¶æ€å¤„ç†åŠŸèƒ½ï¼Œå…è®¸å°†æœ¬åœ°æ•°æ®ä¸è¿œç¨‹æ•°æ®ä¸€èµ·å­˜å‚¨åœ¨Apolloç¼“å­˜ä¸­ã€‚è¦è®¿é—®æœ¬åœ°æ•°æ®ï¼Œåªéœ€ä½¿ç”¨<code>GraphQLæŸ¥è¯¢</code>å³å¯ã€‚</p>
<p>è€Œåœ¨<code>2.5ç‰ˆæœ¬ä¹‹å‰</code>ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨æœ¬åœ°çŠ¶æ€ç®¡ç†ï¼Œå¿…é¡»å¼•å…¥å·²ç»åºŸå¼ƒçš„ä¸€ä¸ªåŒ…<code>apollo-link-state</code>(<a href="https://www.apollographql.com/docs/link/links/state/#quick-start" target="_blank" rel="noopener">API</a>)ï¼Œ<br>è¿™ä¸ªåŒ…åœ¨2.5ç‰ˆæœ¬å·²è¢«åºŸå¼ƒï¼Œå› ä¸ºä»2.5ç‰ˆæœ¬å¼€å§‹ï¼Œè¿™ä¸ªåŒ…çš„åŠŸèƒ½å·²ç»é›†æˆåˆ°apolloçš„æ ¸å¿ƒä¹‹ä¸­ï¼Œä¸å†é¢å¤–ç»´æŠ¤ä¸€ä¸ªå•ç‹¬çš„åŒ…ã€‚è€Œåœ¨apolloçš„<code>1.xç‰ˆæœ¬</code>ï¼Œå¦‚æœè¦å®ç°æœ¬åœ°çŠ¶æ€ç®¡ç†ï¼Œä¾ç„¶å¾—å¼•å…¥reduxã€‚</p>
<p>Apollo Clientæœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•å¯ä»¥æ‰§è¡Œå±€éƒ¨çŠ¶æ€çªå˜ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨<code>cache.writeData</code>ç›´æ¥å†™å…¥ç¼“å­˜ã€‚<br>  åœ¨<a href="#æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query">æ›´æ–°ç¼“å­˜</a>é‚£ä¸€èŠ‚ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»è¿‡<code>cache.writeData</code>çš„ç”¨æ³•ï¼Œä»¥åŠå…¶ä½™<code>updateå‡½æ•°</code>çš„æ­é…ä½¿ç”¨ã€‚</li>
<li>ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå¸¦æœ‰GraphQLçªå˜ï¼ˆmutationï¼‰çš„Mutationç»„ä»¶ï¼Œè¯¥ç»„ä»¶è°ƒç”¨æœ¬åœ°å®¢æˆ·ç«¯è§£æå™¨ï¼ˆresolversï¼‰ã€‚<br>  å¦‚æœmutationä¾èµ–äºç¼“å­˜ä¸­çš„ç°æœ‰å€¼ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨è§£æå™¨ï¼ˆresolversï¼Œåé¢ä¸¤èŠ‚å°†ä»‹ç»ï¼Œç›®å‰åªéœ€çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œå®ƒå’Œ<code>apollo-server</code>ç«¯çš„resolverå®Œå…¨ç›¸åŒï¼‰ã€‚</li>
</ul>
<h3 id="ç›´æ¥å†™å…¥ç¼“å­˜"><a href="#ç›´æ¥å†™å…¥ç¼“å­˜" class="headerlink" title="ç›´æ¥å†™å…¥ç¼“å­˜"></a>ç›´æ¥å†™å…¥ç¼“å­˜</h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApolloConsumer &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'./Link'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FilterLink = <span class="function">(<span class="params">&#123; filter, children &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;ApolloConsumer&gt;</span><br><span class="line">    &#123;<span class="function"><span class="params">client</span> =&gt;</span> (</span><br><span class="line">      &lt;Link</span><br><span class="line">        onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> client.writeData(&#123; data: &#123; visibilityFilter: filter &#125; &#125;)&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">    )&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>ApolloConsumer&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Apolloåœ¨<code>ApolloConsumerç»„ä»¶</code>(<a href="https://www.apollographql.com/docs/react/api/react-apollo/#apolloconsumer" target="_blank" rel="noopener">API</a>)æˆ–<code>Queryç»„ä»¶</code>çš„render propä¸­æ³¨å…¥äº†Apollo Clientå®ä¾‹ï¼Œ<br>æ‰€ä»¥å½“ä½¿ç”¨è¿™äº›ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»ç»„ä»¶çš„<code>props</code>ä¸­æ‹¿åˆ°<code>clientå®ä¾‹</code>ã€‚</p>
</blockquote>
<p>ç›´æ¥å†™å…¥ç¼“å­˜ä¸éœ€è¦GraphQL<code>mutate</code>å‡½æ•°æˆ–<code>resolvers</code>å‡½æ•°ã€‚å› æ­¤æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­æ²¡æœ‰ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨<code>onClick</code>äº‹ä»¶å‡½æ•°é‡Œé¢è°ƒç”¨<code>client.writeData</code>æ¥å†™å…¥ç¼“å­˜ã€‚</p>
<p>ä½†æ˜¯åªå»ºè®®å°†<code>ç›´æ¥å†™å…¥ç¼“å­˜</code>ç”¨äºç®€å•å†™å…¥ï¼Œä¾‹å¦‚å†™å…¥å­—ç¬¦ä¸²æˆ–ä¸€æ¬¡æ€§å†™å…¥ã€‚<br>é‡è¦çš„æ˜¯è¦æ³¨æ„ç›´æ¥å†™å…¥å¹¶ä¸æ˜¯ä½œä¸º<code>GraphQLçªå˜</code>å®ç°çš„ï¼Œå› æ­¤ä¸åº”å°†å®ƒä»¬åŒ…å«åœ¨å¤æ‚çš„å¼€å‘æ¨¡å¼ä¹‹ä¸­ã€‚<br>å®ƒä¹Ÿä¸ä¼šéªŒè¯ä½ å†™å…¥ç¼“å­˜çš„æ•°æ®æ˜¯å¦ä¸ºæœ‰æ•ˆGraphQLæ•°æ®çš„ç»“æ„ã€‚<br>å¦‚æœä»¥ä¸Šæåˆ°çš„ä»»ä½•ä¸€ç‚¹å¯¹æ‚¨å¾ˆé‡è¦ï¼Œåˆ™åº”é€‰æ‹©ä½¿ç”¨æœ¬åœ°<code>resolvers</code>ã€‚</p>
<h3 id="client-æŒ‡ä»¤"><a href="#client-æŒ‡ä»¤" class="headerlink" title="@client æŒ‡ä»¤"></a>@client æŒ‡ä»¤</h3><p>ä¸Šä¸€èŠ‚æåˆ°è¿‡ï¼Œ<code>Queryç»„ä»¶</code>çš„render propåŒæ ·åŒ…å«clientå®ä¾‹ã€‚æ‰€ä»¥é…åˆ<code>@client</code>æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>Queryç»„ä»¶</code>ä¸­è½»æ¾åœ°ä»<code>cache</code>æˆ–<code>resolvers</code>è·å–æœ¬åœ°çŠ¶æ€ã€‚<br>æˆ–è®¸æ¢ä¸ªæ–¹å¼ä»‹ç»å¤§å®¶èƒ½ç†è§£å¾—æ›´é€å½»ï¼šé…åˆ<code>@client</code>æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>Queryç»„ä»¶</code>ä¸­è½»æ¾åœ°ä»<code>cache</code>è·å–æœ¬åœ°çŠ¶æ€ï¼Œæˆ–è€…é€šè¿‡<code>resolvers</code>ä»<code>cache</code>è·å–æœ¬åœ°çŠ¶æ€ã€‚</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Query &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'./Link'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GET_VISIBILITY_FILTER = gql<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    visibilityFilter @client</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FilterLink = <span class="function">(<span class="params">&#123; filter, children &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Query query=&#123;GET_VISIBILITY_FILTER&#125;&gt;</span><br><span class="line">    &#123;<span class="function">(<span class="params">&#123; data, client &#125;</span>) =&gt;</span> (</span><br><span class="line">      &lt;Link</span><br><span class="line">        onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> client.writeData(&#123; data: &#123; visibilityFilter: filter &#125; &#125;)&#125;</span><br><span class="line">        active=&#123;data.visibilityFilter === filter&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">    )&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Query&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ä»£ç è§£è¯»ï¼š</p>
<p><code>@client</code>æŒ‡ä»¤å‘Šè¯‰Apollo Clientåœ¨æœ¬åœ°è·å–æ•°æ®ï¼ˆcacheæˆ–resolversï¼‰ï¼Œè€Œä¸æ˜¯å°†å…¶å‘é€åˆ°graphqlæœåŠ¡å™¨ã€‚<br>åœ¨è°ƒç”¨<code>client.writeData</code>åï¼Œ<code>render propå‡½æ•°</code>ä¸Šçš„æŸ¥è¯¢ç»“æœå°†è‡ªåŠ¨æ›´æ–°ã€‚åŒæ—¶æ‰€æœ‰ç¼“å­˜çš„å†™å…¥å’Œè¯»å–éƒ½æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒåŠ è½½çŠ¶æ€ï¼ˆloadingï¼‰ã€‚</p>
<h3 id="æœ¬åœ°è§£æå™¨â€”â€”resolvers"><a href="#æœ¬åœ°è§£æå™¨â€”â€”resolvers" class="headerlink" title="æœ¬åœ°è§£æå™¨â€”â€”resolvers"></a>æœ¬åœ°è§£æå™¨â€”â€”<a href="https://www.apollographql.com/docs/react/essentials/local-state/#local-resolvers" target="_blank" rel="noopener">resolvers</a></h3><p>ç»ˆäºè§åˆ°äº†ä½ â€”â€”resolversï¼å‰é¢å‡ èŠ‚éƒ½ä¸€ç¬”å¸¦è¿‡äº†<code>resolvers</code>ï¼ˆè§£æå™¨ï¼‰ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æ¥äº†è§£å®ƒåˆ°åº•æœ‰ä»€ä¹ˆå¼ºå¤§çš„åŠŸèƒ½ã€‚</p>
<p>å¦‚æœè¦ä¾èµ–æœ¬åœ°çŠ¶æ€å®ç°<code>GraphQLçš„çªå˜</code>ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ¬åœ°resolverså¯¹è±¡ä¸­<code>æŒ‡å®šä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„å‡½æ•°</code>å³å¯ã€‚<br>åœ¨Apollo Clientçš„å®ä¾‹åŒ–ä¸­ï¼Œ<code>resolvers</code>æ˜ å°„ä¸ºä¸€ä¸ª<code>å¯¹è±¡</code>ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­ä¿å­˜ç€æ¯ä¸€ä¸ªç”¨äºæœ¬åœ°çªå˜çš„<code>resolverå‡½æ•°</code>ã€‚<br>å½“åœ¨GraphQLçš„å­—æ®µä¸Šæ‰¾åˆ°<code>@client</code>æŒ‡ä»¤æ—¶ï¼ŒApollo Clientä¼šåœ¨<code>resolverså¯¹è±¡</code>ä¸­å¯»æ‰¾ä¸ä¹‹å¯¹åº”çš„<code>resolverå‡½æ•°</code>ï¼Œè¿™ä¸ªå¯¹åº”å…³ç³»æ˜¯é€šè¿‡<code>resolversçš„é”®</code>æ¥å…³è”çš„ã€‚</p>
<blockquote>
<p>å³ï¼šå½“æ‰§è¡Œæ²¡æœ‰åŠ <code>@client</code>æŒ‡ä»¤çš„æŸ¥è¯¢æˆ–çªå˜æ—¶ï¼Œ<code>GraphQL</code>æ–‡æ¡£ä¸­çš„å­—æ®µå·²é¢„å®šä¹‰åœ¨äº†æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€åœ¨æŸ¥è¯¢æˆ–çªå˜æ—¶æŒ‰ç…§æœåŠ¡ç«¯å®šä¹‰çš„å­—æ®µç¼–å†™<code>GraphQL</code>æ–‡æ¡£å³å¯ï¼›<br>å½“åŠ ä¸Š@<code>client</code>æŒ‡ä»¤åï¼ŒApollo Clientä¸ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè½¬è€Œåœ¨è‡ªå·±å†…éƒ¨å¯»æ‰¾GraphQLæ–‡æ¡£å†…æŒ‡å®šçš„å­—æ®µã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ€ä¹ˆå»è®¿é—®æœ¬åœ°çš„è¿™äº›å­—æ®µå‘¢ï¼Ÿæˆ–è®¸ä»–ä»¬æ ¹æœ¬å°±ä¸å­˜åœ¨ã€‚<br>(å…³äº<code>@client</code>çš„è¿ä½œæ–¹å¼ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­å…³äºâ€”â€”<a href="https://www.apollographql.com/docs/react/essentials/local-state/#local-data-query-flow" target="_blank" rel="noopener">æœ¬åœ°æ•°æ®æŸ¥è¯¢æµç¨‹</a>çš„éƒ¨åˆ†ï¼Œç”±äºç¯‡å¹…åŸå› ï¼Œæœ¬æ–‡æ¡£ä¸å†è¯¦ç»†ä»‹ç»ã€‚)<br>è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±å®šä¹‰å¯ä»¥è®¿é—®è¿™äº›å­—æ®µçš„æ–¹å¼â€”â€”resolverï¼Œåœ¨è§£æå™¨å¯¹è±¡ï¼ˆresolversï¼‰ä¸­å®šä¹‰ä¸€ä¸ªè§£æå‡½æ•°ï¼ˆresolverï¼‰ï¼Œä»¥ä¾›GraphQLæŸ¥è¯¢æˆ–çªå˜åœ¨ä½¿ç”¨äº†<code>@client</code>æŒ‡ä»¤æ—¶è°ƒç”¨ï¼Œ<br>è¿™æ ·å°±å»ºç«‹äº†GraphQLæŸ¥è¯¢æˆ–çªå˜ä¸Apollo Clientä¹‹é—´çš„è”ç³»ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥è§£ææœ‰<code>@client</code>æŒ‡ä»¤æ§åˆ¶çš„æŸ¥è¯¢æˆ–çªå˜ï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°è¢«å‘½åä¸ºè§£æå‡½æ•°ï¼Œæ„æŒ‡ä»æœ¬åœ°è§£æå‡½æ•°ä¸­å¯»æ‰¾GraphQLæ–‡æ¡£ä¸­æŒ‡å®šçš„å­—æ®µçš„å€¼ã€‚</p>
</blockquote>
<p>é‚£è§£æå‡½æ•°å®šä¹‰åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>å…¶å®å®ƒåœ¨ApolloClientçš„æ„é€ å‡½æ•°ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å®ä¾‹åŒ–Apollo Clientæ—¶ï¼Œéœ€è¦ä¼ é€’resolversç»™å®ƒã€‚</p>
<blockquote>
<p>è§£æå™¨ï¼Œå®ƒå’Œ<code>client-server</code>çš„resolverå‡½æ•°å®Œå…¨ç›¸åŒï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   fieldName: <span class="function">(<span class="params">obj, args, context, info</span>) =&gt;</span> result;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>obj {object}</code>: åŒ…å«çˆ¶å­—æ®µä¸Šresolverå‡½æ•°è¿”å›çš„ç»“æœçš„å¯¹è±¡ï¼Œæˆ–è€…ä¸ºDOMæ ‘æœ€é¡¶å±‚çš„æŸ¥è¯¢æˆ–çªå˜çš„<code>ROOT_QUERY</code>å¯¹è±¡<br><code>args {object}</code>: åŒ…å«ä¼ é€’åˆ°GraphQLæ–‡æ¡£ä¸­çš„æ‰€æœ‰å‚æ•°çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨<code>updateNetworkStatusï¼ˆisConnectedï¼štrueï¼‰</code>è§¦å‘æŸ¥è¯¢æˆ–çªå˜ï¼Œåˆ™<code>args</code>ä¸º<code>{isConnectedï¼štrue}</code>ã€‚<br><code>context {object}</code>: Reactç»„ä»¶ä¸Apollo Clientç½‘ç»œå †æ ˆä¹‹é—´å…±äº«çš„ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å¯¹è±¡ã€‚é™¤äº†å¯èƒ½å­˜åœ¨çš„ä»»ä½•è‡ªå®šä¹‰contextå±æ€§å¤–ï¼Œæœ¬åœ°resolverså§‹ç»ˆä¼šæ”¶åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><code>context.client</code>: Apollo Clientçš„å®ä¾‹</li>
<li><code>context.cache</code>: Apollo Cacheçš„å®ä¾‹<br>  context.cache.readQuery, .writeQuery, .readFragment, .writeFragment, and .writeData: ä¸€ç³»åˆ—ç”¨äºæ“ä½œcacheçš„<a href="https://www.apollographql.com/docs/react/essentials/local-state/#managing-the-cache" target="_blank" rel="noopener">API</a></li>
<li><code>context.getCacheKey</code>: ä½¿ç”¨<code>__typename</code>å’Œ<code>id</code>ä»cacheä¸­è·å–<code>key</code>ã€‚<br><code>info {object}</code>: æœ‰å…³æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€çš„ä¿¡æ¯ã€‚å®é™…ä¸­ï¼Œä½ å¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå‚æ•°ã€‚</li>
</ul>
</blockquote>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  cache: <span class="keyword">new</span> InMemoryCache(),</span><br><span class="line">  resolvers: &#123;</span><br><span class="line">    Mutation: &#123;</span><br><span class="line">      toggleTodo: <span class="function">(<span class="params">_root, variables, &#123; cache, getCacheKey &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> id = getCacheKey(&#123; __typename: <span class="string">'TodoItem'</span>, id: variables.id &#125;)</span><br><span class="line">        <span class="keyword">const</span> fragment = gql<span class="string">`</span></span><br><span class="line"><span class="string">          fragment completeTodo on TodoItem &#123;</span></span><br><span class="line"><span class="string">            completed</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">        <span class="keyword">const</span> todo = cache.readFragment(&#123; fragment, id &#125;);</span><br><span class="line">        <span class="keyword">const</span> data = &#123; ...todo, completed: !todo.completed &#125;;</span><br><span class="line">        cache.writeData(&#123; id, data &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä»£ç è§£æï¼š</p>
<p>ä¸ºäº†åˆ‡æ¢todoçš„çŠ¶æ€ï¼Œé¦–å…ˆéœ€è¦æŸ¥è¯¢ç¼“å­˜ä»¥æ‰¾å‡ºtodoå½“å‰çŠ¶æ€çš„å†…å®¹ï¼Œç„¶åé€šè¿‡ä½¿ç”¨<code>cache.readFragment</code>ä»ç¼“å­˜ä¸­è¯»å–ç‰‡æ®µæ¥å®ç°æ­¤ç›®çš„ã€‚<br>æ­¤å‡½æ•°é‡‡ç”¨<code>fragmentå’Œid</code>ï¼Œå®ƒå¯¹åº”äº<code>item</code>çš„ç¼“å­˜é”®ï¼ˆ<code>cache key</code>ï¼‰ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>context</code>ä¸­çš„<code>getCacheKey</code>å¹¶ä¼ å…¥é¡¹ç›®çš„<code>__typename</code>å’Œ<code>id</code>æ¥è·å–ç¼“å­˜é”®ã€‚</p>
<p>ä¸€æ—¦è¯»å–äº†fragmentï¼Œå°±å¯ä»¥åˆ‡æ¢todoçš„å·²å®ŒæˆçŠ¶æ€å¹¶å°†æ›´æ–°çš„æ•°æ®å†™å›ç¼“å­˜ã€‚ç”±äºæˆ‘ä»¬ä¸æ‰“ç®—åœ¨UIä¸­ä½¿ç”¨mutationçš„è¿”å›ç»“æœï¼Œå› æ­¤æˆ‘ä»¬è¿”å›<code>null</code>ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰GraphQLç±»å‹éƒ½å¯ä»¥ä¸ºç©ºã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆè°ƒç”¨è¿™ä¸ªtoggleTodoè§£æå‡½æ•°ï¼ˆè§¦å‘toggleTodoçªå˜ï¼‰ï¼š</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Mutation &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TOGGLE_TODO = gql<span class="string">`</span></span><br><span class="line"><span class="string">  mutation ToggleTodo($id: Int!) &#123;</span></span><br><span class="line"><span class="string">    toggleTodo(id: $id) @client</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Todo = <span class="function">(<span class="params">&#123; id, completed, text &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Mutation mutation=&#123;TOGGLE_TODO&#125; variables=&#123;&#123; id &#125;&#125;&gt;</span><br><span class="line">    <span class="comment">// ç‰¹åˆ«æ³¨æ„ï¼Œæ­¤toggleTodoéè§£æå™¨é‡Œé¢çš„toggleTodoï¼Œè¿™ä¸ªtoggleTodoæ˜¯æˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡çš„mutateå‡½æ•°ï¼Œè¿™é‡Œè¢«æ›´åä¸ºâ€˜toggleTodoâ€™è€Œå·²ï¼Œä¸è¦æ··æ·†äº†</span></span><br><span class="line">    &#123;<span class="function"><span class="params">toggleTodo</span> =&gt;</span> (</span><br><span class="line">      &lt;li</span><br><span class="line">        onClick=&#123;toggleTodo&#125;</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          textDecoration: completed ? <span class="string">'line-through'</span> : <span class="string">'none'</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;text&#125;</span><br><span class="line">      &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    )&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Mutation&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ä»£ç è§£æï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªGraphQLçªå˜æ–‡æ¡£ï¼Œå®ƒå°†æˆ‘ä»¬æƒ³è¦åˆ‡æ¢çš„itemçš„idä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨<code>@client</code>æŒ‡ä»¤æ ‡è®°<code>GraphQL</code>çš„<code>toggleTodo</code>å­—æ®µæ¥æŒ‡ç¤ºè¿™æ˜¯ä¸€ä¸ªæœ¬åœ°çªå˜ã€‚<br>è¿™å°†å‘Šè¯‰Apollo Clientè°ƒç”¨æˆ‘ä»¬æœ¬åœ°çªå˜è§£æå™¨ï¼ˆresolversï¼‰é‡Œé¢çš„<code>toggleTodo</code>è§£æå‡½æ•°æ¥è§£æè¯¥å­—æ®µã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>Mutationç»„ä»¶</code>ï¼Œå°±åƒæˆ‘ä»¬æ“ä½œè¿œç¨‹çªå˜ä¸€æ ·ã€‚<br>æœ€åï¼Œå°†GraphQLçªå˜ä¼ é€’ç»™ç»„ä»¶ï¼Œå¹¶åœ¨<code>render propå‡½æ•°</code>çš„UIä¸­è§¦å‘å®ƒã€‚</p>
<h3 id="æŸ¥è¯¢æœ¬åœ°çŠ¶æ€"><a href="#æŸ¥è¯¢æœ¬åœ°çŠ¶æ€" class="headerlink" title="æŸ¥è¯¢æœ¬åœ°çŠ¶æ€"></a>æŸ¥è¯¢æœ¬åœ°çŠ¶æ€</h3><p>æŸ¥è¯¢æœ¬åœ°æ•°æ®ä¸æŸ¥è¯¢GraphQLæœåŠ¡å™¨éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯æœ¬åœ°æŸ¥è¯¢åœ¨å­—æ®µä¸Šæ·»åŠ äº†<code>@client</code>æŒ‡ä»¤ï¼Œä»¥æŒ‡ç¤ºå®ƒä»¬åº”è¯¥ä»Apollo Client cacheæˆ–resolversä¸­è§£æã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Query &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Todo <span class="keyword">from</span> <span class="string">'./Todo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GET_TODOS = gql<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    todos @client &#123;</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      completed</span></span><br><span class="line"><span class="string">      text</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    visibilityFilter @client</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoList = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Query query=&#123;GET_TODOS&#125;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      (&#123; data: &#123; todos, visibilityFilter &#125; &#125;) =&gt; (</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            getVisibleTodos(todos, visibilityFilter).map(<span class="function"><span class="params">todo</span> =&gt;</span> (</span><br><span class="line">              &lt;Todo key=&#123;todo.id&#125; &#123;...todo&#125; /&gt;</span><br><span class="line">            ))</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Query&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ä»£ç è§£æï¼š</p>
<p>åˆ›å»ºGraphQLæŸ¥è¯¢å¹¶å°†<code>@client</code>æŒ‡ä»¤æ·»åŠ åˆ°GraphQLæ–‡æ¡£çš„todoså’ŒvisibilityFilterå­—æ®µã€‚<br>ç„¶åï¼Œæˆ‘ä»¬å°†æŸ¥è¯¢ä¼ é€’ç»™<code>Queryç»„ä»¶</code>ã€‚<code>@client</code>æŒ‡ä»¤è®©<code>Queryç»„ä»¶</code>çŸ¥é“åº”è¯¥ä»Apollo Clientç¼“å­˜ä¸­æå–todoså’ŒvisibilityFilterï¼Œæˆ–è€…ä½¿ç”¨é¢„å®šä¹‰çš„æœ¬åœ°resolverè§£æã€‚</p>
<p>ç”±äºä¸Šé¢çš„æŸ¥è¯¢åœ¨å®‰è£…ç»„ä»¶åç«‹å³è¿è¡Œï¼Œå¦‚æœcacheä¸­æ²¡æœ‰itemæˆ–è€…æ²¡æœ‰å®šä¹‰ä»»ä½•æœ¬åœ°resolverï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨è¿è¡ŒæŸ¥è¯¢ä¹‹å‰å°†åˆå§‹çŠ¶æ€å†™å…¥ç¼“å­˜ï¼Œä»¥é˜²æ­¢é”™è¯¯è¾“å‡ºã€‚</p>
<h3 id="åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€"><a href="#åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€" class="headerlink" title="åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€"></a>åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€</h3><p>é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å°†åˆå§‹çŠ¶æ€å†™å…¥ç¼“å­˜ï¼Œä»¥ä¾¿åœ¨è§¦å‘mutationä¹‹å‰æŸ¥è¯¢æ•°æ®çš„æ‰€æœ‰ç»„ä»¶éƒ½ä¸ä¼šå‡ºé”™ã€‚<br>è¦å®ç°æ­¤ç›®çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>cache.writeData</code>ä¸ºåˆå§‹å€¼å‡†å¤‡ç¼“å­˜ã€‚</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> InMemoryCache();</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  cache,</span><br><span class="line">  resolvers: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cache.writeData(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    todos: [],</span><br><span class="line">    visibilityFilter: <span class="string">'SHOW_ALL'</span>,</span><br><span class="line">    networkStatus: &#123;</span><br><span class="line">      __typename: <span class="string">'NetworkStatus'</span>,</span><br><span class="line">      isConnected: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šApollo v2.4å’Œv2.5å†™å…¥åˆå§‹æœ¬åœ°çŠ¶æ€çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œè¯¦æƒ…å‚è€ƒ<a href="https://www.apollographql.com/docs/link/links/state/#defaults" target="_blank" rel="noopener">å®˜æ–¹API</a>ã€‚</p>
<h3 id="é‡ç½®æœ¬åœ°çŠ¶æ€-ç¼“å­˜"><a href="#é‡ç½®æœ¬åœ°çŠ¶æ€-ç¼“å­˜" class="headerlink" title="é‡ç½®æœ¬åœ°çŠ¶æ€/ç¼“å­˜"></a>é‡ç½®æœ¬åœ°çŠ¶æ€/ç¼“å­˜</h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> InMemoryCache();</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  cache,</span><br><span class="line">  resolvers: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  todos: [],</span><br><span class="line">  visibilityFilter: <span class="string">'SHOW_ALL'</span>,</span><br><span class="line">  networkStatus: &#123;</span><br><span class="line">    __typename: <span class="string">'NetworkStatus'</span>,</span><br><span class="line">    isConnected: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">cache.writeData(&#123; data &#125;);</span><br><span class="line"></span><br><span class="line">client.onResetStore(<span class="function"><span class="params">()</span> =&gt;</span> cache.writeData(&#123; data &#125;));</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>client.onResetStore</code>æ–¹æ³•å¯ä»¥é‡ç½®ç¼“å­˜ã€‚</p>
<h3 id="åŒæ—¶è¯·æ±‚æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®"><a href="#åŒæ—¶è¯·æ±‚æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®" class="headerlink" title="åŒæ—¶è¯·æ±‚æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®"></a>åŒæ—¶è¯·æ±‚æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mutation ToggleTodo($id: Int!) &#123;</span><br><span class="line">  toggleTodo(id: $id) @client</span><br><span class="line">  getData(id: $id) &#123;</span><br><span class="line">    id,</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åªéœ€åœ¨éœ€è¦ä»æœ¬åœ°æŸ¥è¯¢çš„å­—æ®µåé¢åŠ ä¸Š<code>@client</code>æŒ‡ä»¤å³å¯ã€‚</p>
<h3 id="ä½¿ç”¨-clientå­—æ®µä½œä¸ºå˜é‡"><a href="#ä½¿ç”¨-clientå­—æ®µä½œä¸ºå˜é‡" class="headerlink" title="ä½¿ç”¨@clientå­—æ®µä½œä¸ºå˜é‡"></a>ä½¿ç”¨@clientå­—æ®µä½œä¸ºå˜é‡</h3><p>åœ¨åŒä¸€ä¸ªgraphqlè¯­å¥ä¸­ï¼Œè¿˜å¯ä»¥å°†ä»æœ¬åœ°æŸ¥åˆ°çš„çŠ¶æ€ç”¨äºä¸‹ä¸€ä¸ªæŸ¥è¯¢ï¼Œé€šè¿‡<code>@export</code>æŒ‡ä»¤</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpLink &#125; <span class="keyword">from</span> <span class="string">'apollo-link-http'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query currentAuthorPostCount($authorId: Int!) &#123;</span></span><br><span class="line"><span class="string">    currentAuthorId @client @export(as: "authorId")</span></span><br><span class="line"><span class="string">    postCount(authorId: $authorId)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> InMemoryCache();</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  link: <span class="keyword">new</span> HttpLink(&#123; uri: <span class="string">'http://localhost:4000/graphql'</span> &#125;),</span><br><span class="line">  cache,</span><br><span class="line">  resolvers: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cache.writeData(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    currentAuthorId: <span class="number">12345</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... run the query using client.query, the &lt;Query /&gt; component, etc.</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>currentAuthorId</code>é¦–å…ˆä»ç¼“å­˜åŠ è½½ï¼Œç„¶åä½œä¸ºauthorIdå˜é‡ï¼ˆç”±@exportï¼ˆasï¼šâ€œauthorIdâ€ï¼‰æŒ‡ä»¤æŒ‡å®šï¼‰ä¼ é€’åˆ°åç»­postCountå­—æ®µä¸­ã€‚<br>@exportæŒ‡ä»¤ä¹Ÿå¯ç”¨äºé€‰æ‹©é›†ä¸­çš„ç‰¹å®šå­—æ®µï¼Œå¦‚ï¼š</p>
<p><code>@export</code>æŒ‡ä»¤è¿˜å¯ä»¥ç”¨äºé€‰æ‹©é›†ä¸­çš„ç‰¹å®šå­—æ®µ</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpLink &#125; <span class="keyword">from</span> <span class="string">'apollo-link-http'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query currentAuthorPostCount($authorId: Int!) &#123;</span></span><br><span class="line"><span class="string">    currentAuthor @client &#123;</span></span><br><span class="line"><span class="string">      name</span></span><br><span class="line"><span class="string">      authorId @export(as: "authorId")</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    postCount(authorId: $authorId)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> InMemoryCache();</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  link: <span class="keyword">new</span> HttpLink(&#123; uri: <span class="string">'http://localhost:4000/graphql'</span> &#125;),</span><br><span class="line">  cache,</span><br><span class="line">  resolvers: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cache.writeData(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    currentAuthor: &#123;</span><br><span class="line">      __typename: <span class="string">'Author'</span>,</span><br><span class="line">      name: <span class="string">'John Smith'</span>,</span><br><span class="line">      authorId: <span class="number">12345</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... run the query using client.query, the &lt;Query /&gt; component, etc.</span></span><br></pre></td></tr></table></figure>
<p><code>@export</code>æŒ‡ä»¤ä½¿ç”¨ä¸ä»…é™äºè¿œç¨‹æŸ¥è¯¢ï¼›å®ƒè¿˜å¯ä»¥ç”¨äºä¸ºå…¶ä»–<code>@client</code>å­—æ®µæˆ–é€‰æ‹©é›†å®šä¹‰å˜é‡ï¼š(æ³¨æ„ä»¥ä¸‹ä»£ç ä¸­GraphQLæ–‡æ¡£çš„<code>currentAuthorId</code>å’Œ<code>postCount</code>å­—æ®µä¹‹åéƒ½æœ‰<code>@client</code>æŒ‡ä»¤)</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query currentAuthorPostCount($authorId: Int!) &#123;</span></span><br><span class="line"><span class="string">    currentAuthorId @client @export(as: "authorId")</span></span><br><span class="line"><span class="string">    postCount(authorId: $authorId) @client</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> InMemoryCache();</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  cache,</span><br><span class="line">  resolvers: &#123;</span><br><span class="line">    Query: &#123;</span><br><span class="line">      postCount(_, &#123; authorId &#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> authorId === <span class="number">12345</span> ? <span class="number">100</span> : <span class="number">0</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cache.writeData(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    currentAuthorId: <span class="number">12345</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... run the query using client.query, the &lt;Query /&gt; component, etc.</span></span><br></pre></td></tr></table></figure>
<h3 id="åŠ¨æ€æ³¨å…¥resolver"><a href="#åŠ¨æ€æ³¨å…¥resolver" class="headerlink" title="åŠ¨æ€æ³¨å…¥resolver"></a>åŠ¨æ€æ³¨å…¥resolver</h3><p>æœ‰æ—¶ï¼Œå½“æˆ‘ä»¬åœ¨APPä¸­ä½¿ç”¨äº†ä»£ç æ‹†åˆ†ï¼Œå¦‚ä½¿ç”¨<code>react-loadable</code>æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯å¾ˆå¸Œæœ›æ‰€æœ‰çš„resolveréƒ½åœ¨åˆå§‹åŒ–Apolloå®¢æˆ·ç«¯çš„ç»Ÿä¸€å†™åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯å¸Œæœ›å•ç‹¬æ‹†åˆ†åˆ°å„è‡ªçš„æ¨¡å—ä¸­ï¼Œè¿™æ ·åœ¨APPç¼–è¯‘åï¼Œ<br>æ¯ä¸ªæ¨¡å—å„è‡ªresolverå°†åŒ…å«åœ¨è‡ªå·±çš„åŒ…ä¸­ï¼Œè¿™æ ·ä¹Ÿæœ‰åŠ©äºå‡å°‘å…¥å£æ–‡ä»¶çš„å¤§å°ï¼Œä½¿ç”¨<code>addResolvers</code> å’Œ <code>setResolvers</code>å³å¯åŠåˆ°ï¼ˆ<a href="https://www.apollographql.com/docs/react/essentials/local-state/#methods" target="_blank" rel="noopener">API</a>ï¼‰ï¼Œ<br>ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'./components/Loading'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Stats = Loadable(&#123;</span><br><span class="line">  loader: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./components/stats/Stats'</span>),</span><br><span class="line">  loading: Loading,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApolloConsumer, Query &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GET_MESSAGE_COUNT = gql<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    messageCount @client &#123;</span></span><br><span class="line"><span class="string">      total</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line">  Query: &#123;</span><br><span class="line">    messageCount: <span class="function">(<span class="params">_, args, &#123; cache &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ... calculate and return the number of messages in</span></span><br><span class="line">      <span class="comment">// the cache ...</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        total: <span class="number">123</span>,</span><br><span class="line">        __typename: <span class="string">'MessageCount'</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MessageCount = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ApolloConsumer&gt;</span><br><span class="line">      &#123;<span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line">        client.addResolvers(resolvers);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          &lt;Query query=&#123;GET_MESSAGE_COUNT&#125;&gt;</span><br><span class="line">            &#123;<span class="function">(<span class="params">&#123; loading, data: &#123; messageCount &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (loading) <span class="keyword">return</span> <span class="string">'Loading ...'</span>;</span><br><span class="line">              <span class="keyword">return</span> (</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                  Total <span class="built_in">number</span> of messages: &#123;messageCount.total&#125;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">              );</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Query&gt;</span><br><span class="line">        );</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &lt;<span class="regexp">/ApolloConsumer&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default MessageCount;</span></span><br></pre></td></tr></table></figure>
<h2 id="è„±ç¦»Reactæ ‡ç­¾çš„å†™æ³•"><a href="#è„±ç¦»Reactæ ‡ç­¾çš„å†™æ³•" class="headerlink" title="è„±ç¦»Reactæ ‡ç­¾çš„å†™æ³•"></a>è„±ç¦»Reactæ ‡ç­¾çš„å†™æ³•</h2><p>ç”±äºç¼–ç¨‹ä¹ æƒ¯çš„ä¸åŒï¼Œæœ‰äº›äººï¼ˆæ¯”å¦‚æˆ‘ï¼‰ï¼Œå¹¶ä¸æ˜¯å¾ˆå–œæ¬¢ï¼ˆæˆ–è€…è¯´æˆä¹ æƒ¯ï¼‰æŠŠ<code>é€»è¾‘ä»£ç </code>å’Œ<code>Reactæ ‡ç­¾</code>æ··åˆå†™åœ¨ä¸€èµ·ï¼Œå°±å¦‚æˆ‘ä»¬ä»æœ¬æ–‡æ¡£å¼€å§‹ä¸€è·¯çœ‹æ¥æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç é‚£æ ·ï¼<br>ä¸ªäººè§‰å¾—åœ¨ä¸€ä¸ªå¤§å‹çš„é¡¹ç›®ä¸­æŠŠ<code>Queryæ ‡ç­¾</code>ã€<code>Mutationæ ‡ç­¾</code>ä»¥åŠå…¶ä»–çš„å„ç§æ ‡ç­¾å±‚å±‚åµŒå¥—ï¼Œå†åŠ ä¸Šå„ç§é€»è¾‘å®ç°ä»£ç ï¼Œå…¨éƒ¨æŒ¤åœ¨Reactç»„ä»¶ä¸­ï¼ŒçœŸçš„æ˜¯ä¸€ä»¶ç³Ÿç³•çš„äº‹æƒ…ã€‚<br>è™½ç„¶å®˜æ–¹æ¨å´‡è¿™ç§å†™æ³•ï¼ˆä»¥ä¸Šç»å¤§éƒ¨åˆ†ä»£ç æ˜¯å®˜æ–¹æ–‡æ¡£çš„ç¤ºä¾‹ï¼‰ï¼Œä»–ä»¬ç»™å‡ºçš„ç†ç”±æ˜¯è¿™æ ·å†™æ›´æ–¹ä¾¿ï¼Œæ›´ç®€å•ï¼</p>
<p>å› äººè€Œå¼‚å§ï¼</p>
<p>æˆ‘ä¸ªäººæ›´å€¾å‘äºæŠŠ<code>GraphQLå’ŒApolloçš„é€»è¾‘éƒ¨åˆ†</code>ä¸<code>Reactç»„ä»¶</code>åˆ†ç¦»å¼€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>react-apollo</code>åº“æä¾›çš„<code>graphql</code>å’Œ<code>compose</code>æ–¹æ³•åšåˆ°åˆ†ç¦»ã€‚<br>å½“ç„¶ï¼Œåœ¨<code>react-apollo</code>è¿™ä¸ªåŒ…ä¸­å¹¶ä¸æ­¢è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•ï¼Œè¯·å‚è€ƒ<a href="https://www.apollographql.com/docs/react/api/react-apollo/" target="_blank" rel="noopener">React Apollo API</a></p>
<p>ä¸‹é¢å±•ç¤ºä¸€æ®µåˆ†ç¦»å¼€çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Avatar, Card, Icon &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; compose, graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span></span><br><span class="line"><span class="keyword">import</span> &#123; QueryState, Typename &#125; <span class="keyword">from</span> <span class="string">'src/config/clientState'</span></span><br><span class="line"><span class="keyword">import</span> &#123; GET_COMPONENTS_LIST, GET_QUERY_STATE &#125; <span class="keyword">from</span> <span class="string">'src/graphql'</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCorrectQueryState &#125; <span class="keyword">from</span> <span class="string">'src/util'</span></span><br><span class="line"><span class="keyword">import</span> Pagination <span class="keyword">from</span> <span class="string">'../pagination'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.scss'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Meta &#125; = Card</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Type = &#123;</span><br><span class="line">  id: <span class="built_in">number</span>,</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Author = &#123;</span><br><span class="line">  username: <span class="built_in">string</span>,</span><br><span class="line">  email: <span class="built_in">string</span>,</span><br><span class="line">  avatar: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Component = &#123;</span><br><span class="line">  id: <span class="built_in">number</span>,</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  version: <span class="built_in">string</span>,</span><br><span class="line">  chineseName: <span class="built_in">string</span>,</span><br><span class="line">  description: <span class="built_in">string</span>,</span><br><span class="line">  <span class="keyword">type</span>: Type,</span><br><span class="line">  url: <span class="built_in">string</span>,</span><br><span class="line">  author: Author,</span><br><span class="line">  previewUrl: <span class="built_in">string</span>,</span><br><span class="line">  isOwn: <span class="built_in">boolean</span>,</span><br><span class="line">  isStored: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ListComponent = &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    components: Component[],</span><br><span class="line">    compCount: <span class="built_in">number</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  componentsCollect: <span class="function">(<span class="params">[id, isCollect]: [<span class="built_in">number</span>, <span class="built_in">boolean</span>]</span>) =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">  queryState: QueryState</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ListComponent = <span class="function">(<span class="params">props: ListComponent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> cardList: React.MutableRefObject&lt;HTMLDivElement | <span class="literal">null</span>&gt; = useRef(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> &#123; data, componentsCollect, queryState &#125; = props</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½æ—¶ç»„ä»¶å¡ç‰‡çš„åŠ¨ç”»æ•ˆæœï¼Œé…åˆReactçš„refå’Œkeyå±æ€§ä½¿ç”¨</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(cardList.current) &#123;</span><br><span class="line">      cardList.current.childNodes.forEach(<span class="function">(<span class="params">element: HTMLElement, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          element.classList.add(<span class="string">'card-load-anim'</span>)</span><br><span class="line">        &#125;, index * <span class="number">40</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">'m-list'</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">'m-cards'</span> ref=&#123;cardList&#125; key=&#123;<span class="built_in">Math</span>.random()&#125;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          !data || !data.components</span><br><span class="line">            ? <span class="literal">null</span></span><br><span class="line">            : data.components.map(<span class="function">(<span class="params">o: Components, i: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> (</span><br><span class="line">                &lt;Card</span><br><span class="line">                  key=&#123;<span class="string">`m-list-btn-<span class="subst">$&#123;i&#125;</span>`</span>&#125;</span><br><span class="line">                  hoverable=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">                  cover=&#123;&lt;img alt=<span class="string">'example'</span> src=<span class="string">'https://gw.alipayobjects.com/zos/rmsportal/JiqGstEfoWAOHiTxclqi.png'</span> /&gt;&#125;</span><br><span class="line">                  actions=&#123;</span><br><span class="line">                    [</span><br><span class="line">                      &lt;a</span><br><span class="line">                        className=&#123;<span class="string">`<span class="subst">$&#123;o.isOwn ? 'm-list-btn-text-disabled' : 'm-list-btn-text'&#125;</span>`</span>&#125;</span><br><span class="line">                        key=&#123;<span class="string">`m-list-btn-<span class="subst">$&#123;i&#125;</span>-1`</span>&#125;</span><br><span class="line">                        href=<span class="string">'javascript:void(0)'</span></span><br><span class="line">                        onClick=&#123;!o.isOwn ? componentsCollect.bind(<span class="literal">null</span>, [o.id, !o.isStored]) : <span class="literal">null</span>&#125;</span><br><span class="line">                      &gt;</span><br><span class="line">                        &lt;Icon <span class="keyword">type</span>=<span class="string">'copy'</span> /&gt;</span><br><span class="line">                        &#123;o.isStored ? <span class="string">'å–æ¶ˆæ”¶è—'</span> : <span class="string">'æ”¶è—'</span>&#125;</span><br><span class="line">                      &lt;<span class="regexp">/a&gt;,</span></span><br><span class="line"><span class="regexp">                      &lt;a</span></span><br><span class="line"><span class="regexp">                        className='m-list-btn-text'</span></span><br><span class="line"><span class="regexp">                        key='m-list-btn-2'</span></span><br><span class="line"><span class="regexp">                        href='javascript:void(0)'</span></span><br><span class="line"><span class="regexp">                      &gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Icon type='file-search' /</span>&gt;</span><br><span class="line">                        æ–‡æ¡£</span><br><span class="line">                      &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">                    ]</span></span><br><span class="line"><span class="regexp">                  &#125;</span></span><br><span class="line"><span class="regexp">                &gt;</span></span><br><span class="line"><span class="regexp">                  &lt;Meta</span></span><br><span class="line"><span class="regexp">                    avatar=&#123;&lt;Avatar src='https:/</span><span class="regexp">/zos.alipayobjects.com/</span>rmsportal/ODTLcjxAfvqbxHnVXCYX.png<span class="string">' /&gt;&#125;</span></span><br><span class="line"><span class="string">                    title=&#123;o.name&#125;</span></span><br><span class="line"><span class="string">                    description=&#123;o.description&#125;</span></span><br><span class="line"><span class="string">                  /&gt;</span></span><br><span class="line"><span class="string">                &lt;/Card&gt;</span></span><br><span class="line"><span class="string">              )</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;Pagination totalPages=&#123;Math.ceil(data.compCount / queryState.pagination.size)&#125; total=&#123;data.compCount&#125; /&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default compose(</span></span><br><span class="line"><span class="string">  graphql(</span></span><br><span class="line"><span class="string">    gql(GET_QUERY_STATE),</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      props: (&#123; data: &#123; queryState &#125; &#125;: any) =&gt; (&#123; queryState &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ),</span></span><br><span class="line"><span class="string">  graphql(</span></span><br><span class="line"><span class="string">    gql(GET_COMPONENTS_LIST),</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      options: (&#123; queryState &#125;: any) =&gt; (&#123;</span></span><br><span class="line"><span class="string">        variables: &#123;</span></span><br><span class="line"><span class="string">          ...getCorrectQueryState(queryState)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ),</span></span><br><span class="line"><span class="string">  graphql(gql`</span></span><br><span class="line"><span class="string">    mutation ($id: Int!, $isCollect: Boolean!)&#123;</span></span><br><span class="line"><span class="string">      storeComponent(id: $id, isStore: $isCollect)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `, &#123;</span></span><br><span class="line"><span class="string">    props: (&#123; mutate &#125;: any) =&gt; (&#123;</span></span><br><span class="line"><span class="string">      componentsCollect: ([id, isCollect]: [number, boolean]) =&gt; &#123;</span></span><br><span class="line"><span class="string">        debugger</span></span><br><span class="line"><span class="string">        mutate(&#123;</span></span><br><span class="line"><span class="string">          variables: &#123; id, isCollect &#125;,</span></span><br><span class="line"><span class="string">          optimisticResponse: &#123;</span></span><br><span class="line"><span class="string">            __typename: Typename.Mutation,</span></span><br><span class="line"><span class="string">            storeComponent: &#123;</span></span><br><span class="line"><span class="string">              __typename: Typename.Component,</span></span><br><span class="line"><span class="string">              id,</span></span><br><span class="line"><span class="string">              isStored: isCollect</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">)(ListComponent)</span></span><br></pre></td></tr></table></figure>
<p>å†™åœ¨æœ€åï¼š</p>
<p>å¦‚æœè®¤çœŸå­¦ä¹ å®Œè¿™æ‰æ–‡æ¡£ï¼Œç›¸ä¿¡ä½ å¯¹ApolloæŠ€æœ¯æ ˆå¼€å‘Reactåº”ç”¨å·²ç»ç®—æ˜¯å…¥é—¨äº†ï¼Œä»Šåå¼€å‘æ—¶é‡åˆ°é—®é¢˜ï¼Œå¤šçœ‹ä¸€çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œç›¸ä¿¡ä½ ä¼šå¾ˆå¿«æŒæ¡å®ƒã€‚</p>
<p>ç”±äºæ°´å¹³æœ‰é™ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘è‡ªå·±ä¸€è¾¹ç¿»è¯‘ä¸€è¾¹åŠ å…¥è‡ªå·±çš„ç†è§£è€Œå†™æˆçš„ï¼Œå…¶ä¸­è‚¯å®šå°‘ä¸äº†ä¸€äº›ä¸å¦¥æˆ–é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ï¼</p>

      
    </div>

    <div>
      
        

      
    </div>
  
        <div class="post-tags">
          
            <a href="/tags/react/" rel="tag"># react</a>
          
            <a href="/tags/typescript/" rel="tag"># typescript</a>
          
            <a href="/tags/apollo-client/" rel="tag"># apollo-client</a>
          
            <a href="/tags/Apollo/" rel="tag"># Apollo</a>
          
        </div>
      


    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>ğŸ¶ æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ ğŸ¶</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµèµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat-reward-img.jpg" alt="Oceanxy WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay-reward-img.jpg" alt="Oceanxy Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/12/new-æ“ä½œç¬¦åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ/" rel="next" title="new æ“ä½œç¬¦åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ">
                <i class="fa fa-chevron-left"></i> new æ“ä½œç¬¦åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="uyan_frame"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Oceanxy" />
          <p class="site-author-name" itemprop="name">Oceanxy</p>
          <p class="site-description motion-element" itemprop="description">ä½ æ— æ³•æ‹’ç»ä¸€ä¸ªçƒ­è¡·äºå‰ç«¯å„ç§ç¾å¥½æ•ˆæœçš„å·¥ç¨‹å¸ˆï¼</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/oceanxy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡†å¤‡å·¥ä½œ"><span class="nav-number">1.</span> <span class="nav-text">å‡†å¤‡å·¥ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»ºReacté¡¹ç›®"><span class="nav-number">1.1.</span> <span class="nav-text">åˆ›å»ºReacté¡¹ç›®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ­å»ºGraphQLæœåŠ¡"><span class="nav-number">1.2.</span> <span class="nav-text">æ­å»ºGraphQLæœåŠ¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…éœ€è¦çš„åŒ…"><span class="nav-number">1.3.</span> <span class="nav-text">å®‰è£…éœ€è¦çš„åŒ…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯"><span class="nav-number">1.4.</span> <span class="nav-text">å®ä¾‹åŒ–Apolloå®¢æˆ·ç«¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¼–å†™GraphQLæŸ¥è¯¢è¯­å¥"><span class="nav-number">1.5.</span> <span class="nav-text">ç¼–å†™GraphQLæŸ¥è¯¢è¯­å¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿æ¥Apolloå®¢æˆ·ç«¯åˆ°React"><span class="nav-number">1.6.</span> <span class="nav-text">è¿æ¥Apolloå®¢æˆ·ç«¯åˆ°React</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Queryç»„ä»¶ä¸Mutationç»„ä»¶"><span class="nav-number">2.</span> <span class="nav-text">Queryç»„ä»¶ä¸Mutationç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–æ•°æ®â€”â€”Queryç»„ä»¶"><span class="nav-number">2.1.</span> <span class="nav-text">è·å–æ•°æ®â€”â€”Queryç»„ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ›´æ–°æ•°æ®â€”â€”Mutationç»„ä»¶"><span class="nav-number">2.2.</span> <span class="nav-text">æ›´æ–°æ•°æ®â€”â€”Mutationç»„ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query"><span class="nav-number">2.3.</span> <span class="nav-text">æ›´æ–°ç¼“å­˜â€”â€”mutationåå†…éƒ¨è‡ªåŠ¨query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ApolloèŒƒå¼åŒ–ç¼“å­˜-API"><span class="nav-number">2.4.</span> <span class="nav-text">ApolloèŒƒå¼åŒ–ç¼“å­˜ API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸­åœºä¼‘æ¯"><span class="nav-number">3.</span> <span class="nav-text">ä¸­åœºä¼‘æ¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¬åœ°çŠ¶æ€ç®¡ç†-è¯¦æƒ…"><span class="nav-number">4.</span> <span class="nav-text">æœ¬åœ°çŠ¶æ€ç®¡ç† è¯¦æƒ…</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç›´æ¥å†™å…¥ç¼“å­˜"><span class="nav-number">4.1.</span> <span class="nav-text">ç›´æ¥å†™å…¥ç¼“å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#client-æŒ‡ä»¤"><span class="nav-number">4.2.</span> <span class="nav-text">@client æŒ‡ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æœ¬åœ°è§£æå™¨â€”â€”resolvers"><span class="nav-number">4.3.</span> <span class="nav-text">æœ¬åœ°è§£æå™¨â€”â€”resolvers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æŸ¥è¯¢æœ¬åœ°çŠ¶æ€"><span class="nav-number">4.4.</span> <span class="nav-text">æŸ¥è¯¢æœ¬åœ°çŠ¶æ€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€"><span class="nav-number">4.5.</span> <span class="nav-text">åˆå§‹åŒ–æœ¬åœ°çŠ¶æ€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é‡ç½®æœ¬åœ°çŠ¶æ€-ç¼“å­˜"><span class="nav-number">4.6.</span> <span class="nav-text">é‡ç½®æœ¬åœ°çŠ¶æ€/ç¼“å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŒæ—¶è¯·æ±‚æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®"><span class="nav-number">4.7.</span> <span class="nav-text">åŒæ—¶è¯·æ±‚æœ¬åœ°çŠ¶æ€å’Œè¿œç¨‹æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨-clientå­—æ®µä½œä¸ºå˜é‡"><span class="nav-number">4.8.</span> <span class="nav-text">ä½¿ç”¨@clientå­—æ®µä½œä¸ºå˜é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŠ¨æ€æ³¨å…¥resolver"><span class="nav-number">4.9.</span> <span class="nav-text">åŠ¨æ€æ³¨å…¥resolver</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è„±ç¦»Reactæ ‡ç­¾çš„å†™æ³•"><span class="nav-number">5.</span> <span class="nav-text">è„±ç¦»Reactæ ‡ç­¾çš„å†™æ³•</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Oceanxy</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>
<p style="margin-bottom: 0;">Hosted by <a href="https://pages.coding.me" style="font-weight: bold;color: gray;">Coding Pages</a></p>





        

<div class="busuanzi-count">

  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  

</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  
      
  

  
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2145602"></script>
      <!-- UY END -->
  




  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("E191g8F5s3UAfy93l0N7fzev-gzGzoHsz", "r9EqhsYlCKLtGQ5A9UWBUE90");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



</body>
</html>
